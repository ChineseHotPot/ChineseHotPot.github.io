System.register("chunks:///_virtual/CommonUtils.ts",["cc"],(function(t){var n,o;return{setters:[function(t){n=t.cclegacy,o=t._decorator}],execute:function(){var c;n._RF.push({},"3fb52Waq5NONKSuG7wX2UwR","CommonUtils",void 0);var r=o.ccclass;o.property,t("CommonUtils",r("CommonUtils")(c=function(){function t(){}return t.isNull=function(t){return null==t},t}())||c);n._RF.pop()}}}));

System.register("chunks:///_virtual/DeepClone.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n;return{setters:[function(e){r=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy}],execute:function(){var t;n._RF.push({},"fb835eW4ZpIe6h8WTmIKmQO","DeepClone",void 0);var a=e("DeepClone",function(){function e(){}return e.clone=function(r){var n=new Map;return e._clone(r,0,n)},e._clone=function(n,t,a){if(t>=e.maxDepth)throw new Error("DeepClone: Maximum depth of "+e.maxDepth+" exceeded");if(null===n||"object"!=typeof n)return n;if(e.handleCircular&&a.has(n))return a.get(n);for(var o,u=r(e.handlers);!(o=u()).done;){var c=o.value,l=c[0],f=c[1];if(n instanceof l)return f(n)}return Array.isArray(n)?e.defaultHandlers.array(n,t,a):n instanceof Date?e.defaultHandlers.date(n):n instanceof RegExp?e.defaultHandlers.regexp(n):n instanceof Map?e.defaultHandlers.map(n,t,a):n instanceof Set?e.defaultHandlers.set(n,t,a):e.defaultHandlers.object(n,t,a)},e.registerHandler=function(r,n){e.handlers.set(r,n)},e.unregisterHandler=function(r){e.handlers.delete(r)},e.clearHandlers=function(){e.handlers.clear()},e.setMaxDepth=function(r){if(r<1)throw new Error("Depth must be at least 1");e.maxDepth=r},e.getMaxDepth=function(){return e.maxDepth},e.setHandleCircular=function(r){e.handleCircular=r},e.getHandleCircular=function(){return e.handleCircular},e}());t=a,a.maxDepth=100,a.handleCircular=!0,a.handlers=new Map,a.defaultHandlers={array:function(e,r,n){if(n.has(e))return n.get(e);var a=[];n.set(e,a);for(var o=0;o<e.length;o++)a[o]=t._clone(e[o],r+1,n);return a},date:function(e){return new Date(e.getTime())},regexp:function(e){return new RegExp(e.source,e.flags)},map:function(e,r,n){if(n.has(e))return n.get(e);var a=new Map;return n.set(e,a),e.forEach((function(e,o){a.set(t._clone(o,r+1,n),t._clone(e,r+1,n))})),a},set:function(e,r,n){if(n.has(e))return n.get(e);var a=new Set;return n.set(e,a),e.forEach((function(e){a.add(t._clone(e,r+1,n))})),a},object:function(e,n,a){if(a.has(e))return a.get(e);var o=Object.getPrototypeOf(e),u=Object.create(o);a.set(e,u);for(var c,l=[].concat(Object.getOwnPropertyNames(e),Object.getOwnPropertySymbols(e)),f=r(l);!(c=f()).done;){var i=c.value,s=Object.getOwnPropertyDescriptor(e,i);s&&("value"in s&&(s.value=t._clone(s.value,n+1,a)),Object.defineProperty(u,i,s))}return u}},n._RF.pop()}}}));

System.register("chunks:///_virtual/Defines.ts",["cc"],(function(e){var n,_,T;return{setters:[function(e){n=e.cclegacy,_=e.Color,T=e.Size}],execute:function(){e({Constant:void 0,Debug:void 0,GameDefine:void 0,GameEvent:void 0,Sfx:void 0}),n._RF.push({},"28f5ecthwpGYZAeqGUFMMg9","Defines",void 0);var E,O;e("GAME_VERSION","1.0.12"),e("EChannel",function(e){return e[e.EChannel_Web=0]="EChannel_Web",e[e.EChannel_Google=1]="EChannel_Google",e[e.EChannel_Fackbook=2]="EChannel_Fackbook",e}({})),e("EGameTipsType",function(e){return e[e.EDailyTask=0]="EDailyTask",e[e.ETheme=1]="ETheme",e[e.ESkin=2]="ESkin",e[e.EAchieve=3]="EAchieve",e[e.EChallenge=4]="EChallenge",e}({}));(O=E||(E=e("Debug",{}))).LogEnable=1,O.Test=0,O.TestButton=0,O.NoShuffleMap=0,O.ServerTime10MinForOneDay=0,O.ServerTimeUseLoacalTime=0,O.ShowError=0,O.ABTest=0;var L,t,N,o,S,w,i,a,C=e("PROP_ID",function(e){return e[e.NONE=0]="NONE",e[e.REFRESH=1]="REFRESH",e[e.ADD_TIME=2]="ADD_TIME",e[e.VANISH_COLOR=3]="VANISH_COLOR",e[e.STEP_BACK=4]="STEP_BACK",e[e.UNLOCK_BOTTLE=5]="UNLOCK_BOTTLE",e}({}));(t=L||(L=e("Sfx",{}))).MUSIC_BG="bgmusic",t.SOUND_BUTTON="button",t.SOUND_COLLECT_BOTTLE="shot",t.SOUND_GAME_WIN="win",t.SOUND_GAME_FAIL="fail",t.SOUND_PICK_BOTTLE="pick",t.SOUND_VANISH_COLOR="up",t.SOUND_POUR_WATER_1="water1",t.SOUND_POUR_WATER_2="water2",t.SOUND_POUR_WATER_3="water3",t.SOUND_POUR_WATER_4="water4",t.SOUND_REFRESH_COLOR="star",t.SOUND_GFIT_BOX="box",t.SOUND_LEVEL_UP="levelup",t.SOUND_GET_GIFT="gift",t.SOUND_PROP_ADD_TIME="propaddtime",t.SOUND_PROP_STEP_BACK="propstepback",t.SOUND_PROP_UNLOCK_BOTTLE="propunlockbottle",t.SOUND_PROP_UNLOCK_BOTTLE_2="propunlockbottle2",t.SOUND_PROP_VANISH_COLOR="propvanishcolor",t.SOUND_RANK_UP="rankup",t.SOUND_TRANSFER_BOTTLE="transferbottle",t.SOUND_TASK_BOTTLE="taskbottle",t.SOUND_LOCK_BOOTLE="lockbottle",t.SOUND_PICK_UP_DRIP="pickupdrip",t.SOUND_DROP_DRIP="dropdrip",(o=N||(N=e("GameEvent",{}))).EventGameSettle="event_game_settle",o.EventGameTips="event_game_tips",o.EventPropCountChange="event_prop_count_change",o.EventGameGiveUp="event_game_give_up",o.EventSkipGuide="event_guide_skip",o.EventGameOneKeyClear="event_game_one_key_clear",o.EventChangeThemeChoose="Event_ChangeThemeChoose",o.EventChangeSkinChoose="Event_ChangeSkinChoose",o.EventShareSuccess="event_share_success",o.EventShowGameClube="Event_ShowGameClube",o.EventHideGameClube="Event_HideGameClube",o.EventShowSharReward="Event_ShowShareReward",o.EventWindowResize="Event_WindowResize",o.EventShowStartAnim="Event_ShowStartAnim",o.EventGameSkip="event_game_skip",o.EventSubLevelSkip="event_sub_level_skip",o.EventGameSkipToLevel="event_sub_level_skip_to_level",o.EventGameReduceTime="event_game_reduce_time",o.EventUIClose="EvenTaskUIClose",(w=S||(S=e("Constant",{}))).signInToolId=[C.STEP_BACK,C.STEP_BACK,C.VANISH_COLOR,C.STEP_BACK,C.STEP_BACK,C.STEP_BACK,C.VANISH_COLOR],w.signInToolNum=[1,1,1,1,1,1,1],w.totalSkinNum=10,w.totalThemeNum=10,w.challengeLevel=6,(a=i||(i=e("GameDefine",{}))).LiquidColors=[new _(0,0,0,0),new _(247,220,37,255),new _(40,214,15,255),new _(255,113,36,255),new _(24,220,255,255),new _(255,55,180,255),new _(6,179,135,255),new _(62,76,255,255),new _(178,106,67,255),new _(147,45,236,255),new _(255,40,24,255),new _(0,115,181,255),new _(118,122,0,255),new _(197,153,0,255),new _(25,242,202,255),new _(255,103,103,255)],a.DripColors=[new _(0,0,0,0),new _(255,244,75,255),new _(47,239,20,255),new _(255,143,83,255),new _(56,234,255,255),new _(255,119,204,255),new _(120,201,192,255),new _(70,135,255,255),new _(226,145,101,255),new _(186,107,255,255),new _(255,97,85,255),new _(80,153,223,255),new _(168,174,50,255),new _(223,186,58,255),new _(137,236,205,255),new _(255,148,146,255)],a.BottleColors=[new _(255,255,255,255),new _(255,248,200,255),new _(214,255,208,255),new _(255,236,212,255),new _(199,247,255,255),new _(255,211,239,255),new _(198,255,240,255),new _(219,235,255,255),new _(243,230,211,255),new _(235,213,255,255),new _(255,203,199,255),new _(218,241,255,255),new _(242,244,186,255),new _(252,253,209,255),new _(227,255,250,255),new _(255,240,240,255)],a.BottleShadowColors=[new _(255,255,255,255),new _(255,230,59,255),new _(111,255,90,255),new _(255,153,97,255),new _(0,216,255,255),new _(255,111,201,255),new _(0,171,157,255),new _(57,113,255,255),new _(148,112,93,255),new _(185,107,255,255),new _(255,55,41,255),new _(0,135,212,255),new _(118,122,0,255),new _(197,153,0,255),new _(6,235,193,255),new _(249,81,81,255)],a.HiddenBottleColors=[new _(255,255,255,255),new _(255,222,0,255),new _(30,236,0,255),new _(255,108,0,255),new _(0,216,255,255),new _(255,40,174,255),new _(0,163,150,255),new _(62,76,255,255),new _(198,101,47,255),new _(152,33,255,255),new _(255,40,24,255),new _(3,106,165,255),new _(118,122,0,255),new _(186,144,0,255),new _(75,255,222,255),new _(255,93,93,255)],a.LIQUID_COLOR_UNKNOWN=new _(68,66,61,255),a.BOTTLE_TYPE_EMPTY=0,a.BOTTLE_TYPE_VIDEO=-1,a.BOTTLE_TYPE_UNLOCK=-2,a.DEFAULT_BOTTLE_SEGEMENT=5,a.BOTTLE_WIDTH=79,a.LIQUID_SIZE=new T(133,35.8),a.LONG_BOTTLE_MIN_LENGTH=6,a.LEVEL_COUNT_PER_RANK_LEVEL=6,a.LEVEL_COUNT_PER_GIFT_BOX=5,a.LEVEL_COUNT_PER_GIFT_BOX_B=10,a.MOVE_BOTTLE_TIME_SCALE=2.2,a.POUR_TIME_SCALES=[1.2,1,.8,.6,.6],a.FRAME_TIME=1/30,a.BOTTLE_TOP_ANCHORS=[76/133,99/133,92/133,85/133,86/133,80/133,79/133,78/133,85/133,92/133],a.PLAYER_HEADER_DEFAULT="common/moren",a.LEVEL_GUIDE=1,a.GuideSteps=[{id:0,desc:"选中上面这个杯子。"},{id:1,desc:"倒入空杯中。"},{id:3,desc:"再选中这个颜色的杯子。"},{id:0,desc:"只能倒入最上面一层水相同颜色的杯子。",wrongIndexes:[1]},{id:3,desc:"按上述步骤完成接下来的操作吧。"},{id:1,desc:"按上述步骤完成接下来的操作吧。"},{id:3,desc:"按上述步骤完成接下来的操作吧。"},{id:0,desc:"按上述步骤完成接下来的操作吧。"}],a.MAP_ID_UNLOCK_BOTTLE_GUIDE=3001,a.StuckGuideSteps=[{id:0,desc:""},{id:1,desc:""},{id:3,desc:"解锁空瓶获得额外空间"}];e("NewTypeOpenLevels",function(e){return e[e.None=0]="None",e[e.UNKNOWN_BOTTLE=5]="UNKNOWN_BOTTLE",e[e.TRANSITION_BOTTLE=7]="TRANSITION_BOTTLE",e[e.COLOR_BOTTLE=9]="COLOR_BOTTLE",e[e.TRANSFER_BOTTLE=15]="TRANSFER_BOTTLE",e[e.TASK_BOTTLE=19]="TASK_BOTTLE",e[e.HIDDEN_BOTTLE=51]="HIDDEN_BOTTLE",e[e.STONE_BOTTLE=81]="STONE_BOTTLE",e[e.LOCK_BOTTLE=105]="LOCK_BOTTLE",e}({})),e("GuideType",function(e){return e[e.NONE=0]="NONE",e[e.UNKNOWN_BOTTLE=1]="UNKNOWN_BOTTLE",e[e.LOCK_BOTTLE=2]="LOCK_BOTTLE",e[e.COLOR_BOTTLE=3]="COLOR_BOTTLE",e[e.TRANSFER_BOTTLE=4]="TRANSFER_BOTTLE",e[e.TASK_BOTTLE=5]="TASK_BOTTLE",e[e.TRANSITION_BOTTLE=6]="TRANSITION_BOTTLE",e[e.HIDDEN_BOTTLE=7]="HIDDEN_BOTTLE",e[e.LONG_BOTTLE=8]="LONG_BOTTLE",e[e.STONE_BOTTLE=9]="STONE_BOTTLE",e[e.ALL_LONG_BOTTLE=10]="ALL_LONG_BOTTLE",e}({})),e("GameType",function(e){return e[e.NORMAL=1]="NORMAL",e[e.CHALLENGE=2]="CHALLENGE",e}({}));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameMacros.ts",["cc"],(function(r){var e,t,a;return{setters:[function(r){e=r.cclegacy,t=r._decorator,a=r.Size}],execute:function(){var n,O;e._RF.push({},"2f601HX/RxAc5B4SnOzLjoH","GameMacros",void 0);var E=t.ccclass,T=(t.property,r("GameMacros",E("GameMacros")(((O=function(){function r(){}return r.GetNumberResPath=function(r){var e=r-1;return e>=0&&e<o.length?"Texture/mahjong/0/"+o[e].toString()+"/spriteFrame":""},r.GetCardPlayTypeResPath=function(r,e){return r==T.ICE||r==T.VINE||r==T.BOX2||r==T.BOARDTOP||r==T.BOARDLEFT?"Texture/CardExtType/"+r.toString()+"/spriteFrame":""},r}()).MAP_CUBE_SIZE=new a(144,157),O.MAP_POS_PRE_X=16,O.MAP_POS_PRE_Y=15,O.MAP_POS_SPACE_X=-5,O.MAP_POS_SPACE_Y=-16,O.MAX_MAHJONG_NUM=30,n=O))||n),r("GameDiffMode",function(r){return r[r.Easy=0]="Easy",r[r.Hard=1]="Hard",r[r.Expert=2]="Expert",r[r.Triky=3]="Triky",r}({})),r("CardPlayType",function(r){return r[r.Normal=10]="Normal",r[r.ICE=11]="ICE",r[r.VINE=12]="VINE",r[r.BOX2=13]="BOX2",r[r.BOARDLEFT=14]="BOARDLEFT",r[r.BOARDRIGHT=15]="BOARDRIGHT",r[r.BOARDTOP=16]="BOARDTOP",r[r.BOARDBOTTOM=17]="BOARDBOTTOM",r[r.GLUELEFT=18]="GLUELEFT",r[r.GLUERIGHT=19]="GLUERIGHT",r[r.GLUETOP=20]="GLUETOP",r[r.GLUEBOTTOM=21]="GLUEBOTTOM",r}({}))),o=r("MahjongTypes",new Array(11,12,13,14,15,21,22,23,24,25,31,32,33,34,35,41,42,43,44,45,51,52,53,54,19,61,62,63,64,29));e._RF.pop()}}}));

System.register("chunks:///_virtual/GameModel.ts",["cc","./GameMacros.ts"],(function(e){var t,i,n,a,o;return{setters:[function(e){t=e.cclegacy,i=e._decorator,n=e.Size},function(e){a=e.GameDiffMode,o=e.GameMacros}],execute:function(){var r,s;t._RF.push({},"afd90dHJQBJ6rQyrdbneHqK","GameModel",void 0);var f=i.ccclass,u=(i.property,e("GameModel",f("GameModel")(((s=function(){function e(){this.mGameDiffMode=a.Easy}e.getInstance=function(){return null!=this.instance&&null!=this.instance||(this.instance=new e),this.instance};var t=e.prototype;return t.initGameModel=function(){},t.isValidRow=function(e){return e>=0&&e<this.getRowCfg()},t.isValidCol=function(e){return e>=0&&e<this.getColCfg()},t.isValidRowCol=function(e,t){return this.isValidRow(e)&&this.isValidCol(t)},t.setGameDiffMode=function(e){this.mGameDiffMode=e},t.getRowCfg=function(){var e=8;return this.mGameDiffMode==a.Hard?e=10:(this.mGameDiffMode==a.Expert||this.mGameDiffMode==a.Triky)&&(e=12),e},t.getColCfg=function(){var e=6;return this.mGameDiffMode==a.Hard?e=8:this.mGameDiffMode==a.Expert?e=10:this.mGameDiffMode==a.Triky&&(e=9),e},t.getGameMapSize=function(){var e=this.getRowCfg(),t=this.getColCfg(),i=o.MAP_CUBE_SIZE,a=2*o.MAP_POS_PRE_X+i.width*t+o.MAP_POS_SPACE_X*(t-1),r=2*o.MAP_POS_PRE_Y+i.height*e+o.MAP_POS_SPACE_Y*(e-1)+5;return new n(a,r)},t.getMapInitTable=function(){for(var e=new Array,t=0;t<12;++t){var i=t+1;10==i&&(i+=1),e.push(i),e.push(i),e.push(i),e.push(i)}return e},e}()).instance=void 0,r=s))||r));e("default",u.getInstance());t._RF.pop()}}}));

System.register("chunks:///_virtual/grid-layout.ts",["./rollupPluginModLoBabelHelpers.js","cc","./yx-collection-view.ts"],(function(t){var i,e,r,n,o,a,s,h,l;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,r=t.UITransform,n=t.warn,o=t.math},function(t){a=t.YXCollectionView,s=t.YXLayoutAttributes,h=t.YXIndexPath,l=t.YXLayout}],execute:function(){e._RF.push({},"02a96qsjFJCAbivx+1JqubU","grid-layout",void 0);t("GridLayout",function(t){function e(){for(var i,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(i=t.call.apply(t,[this].concat(r))||this).itemSize=new o.Size(100,100),i.horizontalSpacing=0,i.verticalSpacing=0,i.alignment=1,i._maxItemsPerRow=null,i}i(e,t);var l=e.prototype;return l.getMaxItemsPerRow=function(t){if(null==this._maxItemsPerRow){for(var i=1,e=t.node.getComponent(r).contentSize.width;i*this.itemSize.width+(i-1)*this.horizontalSpacing<=e;)i++;i=Math.max(1,i-1),this._maxItemsPerRow=i}return this._maxItemsPerRow},l.prepare=function(t){if(t.scrollDirection!==a.ScrollDirection.VERTICAL)return t.scrollDirection===a.ScrollDirection.HORIZONTAL?(n("GridLayout 仅支持垂直方向排列"),void this._prepare_vertical(t)):void 0;this._prepare_vertical(t)},l._prepare_vertical=function(t){t.scrollView.horizontal=!1,t.scrollView.vertical=!0;var i=[],e=t.node.getComponent(r).contentSize.clone(),o=e.width;this._maxItemsPerRow=null;var a=this.getMaxItemsPerRow(t),l=0;1==this.alignment&&(l=.5*(o-(a*this.itemSize.width+(a-1)*this.horizontalSpacing)));2==this.alignment&&(l=o-(a*this.itemSize.width+(a-1)*this.horizontalSpacing));t.getNumberOfSections()>1&&n("GridLayout 暂时不支持分区模式");for(var c=t.getNumberOfItems(0),u=0;u<c;u++){var m=Math.floor(u/a),g=u%a,f=l+(this.itemSize.width+this.horizontalSpacing)*g,p=(this.itemSize.height+this.verticalSpacing)*m,S=s.layoutAttributesForCell(new h(0,u));S.frame.x=f,S.frame.y=p,S.frame.width=this.itemSize.width,S.frame.height=this.itemSize.height,i.push(S),e.height=Math.max(e.height,S.frame.yMax)}this.attributes=i,this.contentSize=e},l.initOffset=function(t){t.scrollView.scrollToTop()},l.layoutAttributesForElementsInRect=function(t,i){return this.visibleElementsInRect(t,i)},l.visibleElementsInRect=function(t,i){if(this.attributes.length<=100)return this.attributes;var e=Math.floor(t.y/(this.itemSize.height+this.verticalSpacing)),r=Math.ceil(t.yMax/(this.itemSize.height+this.verticalSpacing)),n=this.getMaxItemsPerRow(i),o=Math.max(e*n,0),a=r*n;return this.attributes.slice(o,a)},e}(l));e._RF.pop()}}}));

System.register("chunks:///_virtual/Log.ts",["cc","./Defines.ts"],(function(t){var r,n,e,o,a;return{setters:[function(t){r=t.cclegacy,n=t.log,e=t.warn,o=t.error},function(t){a=t.Debug}],execute:function(){r._RF.push({},"301deXEbvVAWqhq3ZnqI79M","Log",void 0);t("default",function(){function t(){}return t.log=function(){for(var r=arguments.length,e=new Array(r),o=0;o<r;o++)e[o]=arguments[o];if(a.LogEnable){var i=console.log||n,l=Array.prototype.slice.call(arguments),c=t.stack(2)+t.getDateString()+" ";l.splice(0,0,c),i.apply(i,l)}},t.warn=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];var a=console.warn||e,i=Array.prototype.slice.call(arguments),l=t.stack(2)+t.getDateString()+" ";i.splice(0,0,l),a.apply(a,i)},t.error=function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];var a=console.error||o,i=Array.prototype.slice.call(arguments),l=t.stack(2)+t.getDateString()+" ";i.splice(0,0,l),a.apply(a,i)},t.getDateString=function(){var t=new Date,r=t.getHours().toString(),n="";return n+=(1==r.length?"0"+r:r)+":",n+=(1==(r=t.getMinutes().toString()).length?"0"+r:r)+":",n+=(1==(r=t.getSeconds().toString()).length?"0"+r:r)+":",1==(r=t.getMilliseconds().toString()).length&&(r="00"+r),2==r.length&&(r="0"+r),n="["+(n+=r)+"]"},t.stack=function(t){var r;void 0===t&&(t=2);var n=null==(r=(new Error).stack)?void 0:r.split("\n");n.shift();var e=[];n.forEach((function(t){var r,n=(t=t.substring(7)).split(" ");n.length<2?e.push(n[0]):e.push(((r={})[n[0]]=n[1],r))}));var o=[];if(t<e.length-1)for(var a in e[t])o.push(a);var i=0==o.length?"anonymous":o[0].split(".");return i[0]+".js->"+i[1]+":"},t}());r._RF.pop()}}}));

System.register("chunks:///_virtual/MahjongItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIHelp.ts","./GameMacros.ts"],(function(e){var t,r,i,a,n,o,p,u,l,c,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,p=e.Node,u=e.Component},function(e){l=e.default},function(e){c=e.GameMacros,s=e.CardPlayType}],execute:function(){var m,b,y,h,f,d,T,S,g,v,G,B,C,E,L;n._RF.push({},"c24e02PCohL0YOrXgbg4akf","MahjongItem",void 0);var N=o.ccclass,P=o.property;e("MahjongItem",(m=N("MahjongItem"),b=P({type:p}),y=P({type:p}),h=P({type:p}),f=P({type:p}),d=P({type:p}),T=P({type:p}),m((v=t((g=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,i(t,"numberSp",v,a(t)),i(t,"cardTypeSp",G,a(t)),i(t,"leftBoard",B,a(t)),i(t,"topBoard",C,a(t)),i(t,"leftGlue",E,a(t)),i(t,"topGlue",L,a(t)),t.mNumber=0,t.mCubeType=0,t.mCubeTypeExt=0,t}r(t,e);var n=t.prototype;return n.start=function(){this.numberSp.name},n.update=function(e){},n.getNumber=function(){return this.mNumber},n.setNumber=function(e,t){void 0===t&&(t=!0),this.mNumber=e,t&&this.updateNumber()},n.updateNumber=function(){this.numberSp.name,null!=this.numberSp&&l.SetLocalSpriteFrame(this.numberSp,c.GetNumberResPath(this.mNumber))},n.getCubeExtTypeData=function(){return this.mCubeTypeExt},n.setCubeExtTypeData=function(e){this.mCubeTypeExt=e},n.setCardType=function(e){if(this.mCubeType=e,e==s.Normal)return null!=this.cardTypeSp&&(this.cardTypeSp.active=!1),this.leftBoard&&(this.leftBoard.active=!1),void(this.topBoard&&(this.topBoard.active=!1));e!=s.BOARDLEFT?e!=s.BOARDTOP?e!=s.GLUELEFT?e!=s.GLUETOP?e!=s.GLUERIGHT&&e!=s.GLUEBOTTOM&&null!=this.cardTypeSp&&(e==s.ICE||e==s.VINE?l.SetLocalSpriteFrame(this.cardTypeSp,c.GetCardPlayTypeResPath(e)):e==s.BOX2&&(this.mCubeTypeExt=2,l.SetLocalSpriteFrame(this.cardTypeSp,c.GetCardPlayTypeResPath(e))),this.cardTypeSp.active=!0):this.topGlue.active=!0:this.leftGlue.active=!0:this.topBoard.active=!0:this.leftBoard.active=!0},t}(u)).prototype,"numberSp",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=t(g.prototype,"cardTypeSp",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=t(g.prototype,"leftBoard",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=t(g.prototype,"topBoard",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=t(g.prototype,"leftGlue",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(g.prototype,"topGlue",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=g))||S));n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Defines.ts","./TableCreator.ts","./GameMacros.ts","./GameModel.ts","./MahjongItem.ts","./UI_GameMap.ts","./grid-layout.ts","./yx-collection-view.ts","./yx-table-layout.ts","./CommonUtils.ts","./DeepClone.ts","./WebHelper.mjs_cjs=&original=.js","./TableCalcWokerManager.ts","./TableCalcWorker.ts","./TableGenerateWokerManager.ts","./TableGenerateWorker.ts","./WorkerHelper.mjs_cjs=&original=.js","./WorkerHelper.ts","./Log.ts","./UIHelp.ts","./Utils.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/TableCalcWokerManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Log.ts","./TableCalcWorker.ts"],(function(e){var r,a,o,t,n,s;return{setters:[function(e){r=e.createForOfIteratorHelperLoose,a=e.createClass},function(e){o=e.cclegacy,t=e._decorator},function(e){n=e.default},function(e){s=e.default}],execute:function(){var c,l;o._RF.push({},"c059cioBk1G66+Cfyg+zWqj","TableCalcWokerManager",void 0);var i=t.ccclass;t.property,e("TableCalcWokerManager",i("TableCalcWokerManager")(((l=function(){function e(){this.workerPool=[],this.busyWorkers=new Set}var o=e.prototype;return o.initWorkerPool=function(e){var r=Math.min(navigator.hardwareConcurrency||4,e);n.log("[TableCalcWokerManager] 正在创建 "+r+" 个 Web Workers");for(var a=0;a<r;a++){var o=new Worker(s,{type:"module"});this.workerPool.push(o)}},o.execTask=function(e,r,a){var o=this;return new Promise((function(t,n){var s=o.getAvailableWorker();s?(s.onmessage=function(r){var a=r.data,c=a.type,l=a.taskId,i=a.success;if(e===l)switch(c){case"RESULT":o.releaseWorker(s),i?t(r.data.data):n(r.data.error);break;case"ERROR":o.releaseWorker(s),n(r.data.error)}},s.postMessage({type:"CALCULATE",taskId:e,data:r,args:a})):n("没有可用的 Worker")}))},o.getAvailableWorker=function(){for(var e,a=r(this.workerPool);!(e=a()).done;){var o=e.value;if(!this.busyWorkers.has(o))return this.busyWorkers.add(o),o}return null},o.releaseWorker=function(e){this.busyWorkers.delete(e)},o.terminateAll=function(){n.log("[TableCalcWokerManager] 正在终止所有 Web Workers"),this.workerPool.forEach((function(e){try{e.postMessage({type:"TERMINATE"})}catch(e){n.error("终止 Worker 时出错: "+e)}})),this.workerPool=[],this.busyWorkers.clear()},a(e,null,[{key:"Instance",get:function(){return e.instance||(e.instance=new e),e.instance}}]),e}()).instance=null,c=l))||c);o._RF.pop()}}}));

System.register("chunks:///_virtual/TableCalcWorker.ts",["cc"],(function(r){var e;return{setters:[function(r){e=r.cclegacy}],execute:function(){e._RF.push({},"c1455n2htFCd4h4V0kpKhro","TableCalcWorker",void 0);var n=function(){function r(r,e){return r=Math.ceil(r),e=Math.floor(e),Math.floor(Math.random()*(e-r))+r}var e=function(){function r(r,e){this.x=0,this.y=0,this.x=r,this.y=e}return r.prototype.equals=function(r){return this.x===r.x&&this.y===r.y},r.findIndexInArray=function(r,e){return r.findIndex((function(r){return r.equals(e)}))},r}(),n=function(){function r(r,n){this.rc1=new e(-1,-1),this.rc2=new e(-1,-1),this.rc1=r,this.rc2=n}return r.prototype.isDirH=function(){return this.rc1.x!=this.rc2.x&&this.rc1.y!=this.rc2.y},r}(),t=function(r){return r[r.NONE=0]="NONE",r[r.TOP=1]="TOP",r[r.RIGHT=2]="RIGHT",r[r.BOTTOM=3]="BOTTOM",r[r.LEFT=4]="LEFT",r}({}),a=function(r){return r[r.NONE=0]="NONE",r[r.TOP=1]="TOP",r[r.RIGHT=2]="RIGHT",r[r.BOTTOM=3]="BOTTOM",r[r.LEFT=4]="LEFT",r}({}),o=function(r,n,a,o){this.rc1=new e(-1,-1),this.rc2=new e(-1,-1),this.dir1=t.NONE,this.dir2=t.NONE,this.rc1=r,this.rc2=n,this.dir1=a,this.dir2=o},u=function(){function r(r,e,n,t){this.minRow=0,this.maxRow=0,this.minCol=0,this.maxCol=0,this.minRow=r,this.maxRow=e,this.minCol=n,this.maxCol=t}return r.prototype.Reset=function(){this.minRow=0,this.maxRow=0,this.minCol=0,this.maxCol=0},r}(),i=function(r){return r[r.NONE=10]="NONE",r[r.ICE=11]="ICE",r[r.VINE=12]="VINE",r[r.BOX2=13]="BOX2",r[r.BOARDLEFT=14]="BOARDLEFT",r[r.BOARDRIGHT=15]="BOARDRIGHT",r[r.BOARDTOP=16]="BOARDTOP",r[r.BOARDBOTTOM=17]="BOARDBOTTOM",r[r.GLUELEFT=18]="GLUELEFT",r[r.GLUERIGHT=19]="GLUERIGHT",r[r.GLUETOP=20]="GLUETOP",r[r.GLUEBOTTOM=21]="GLUEBOTTOM",r}({});function f(r){for(var e=new Array,n=0;n<r.length;++n)e.push(r[n].Clone());return e}var l=function(){function r(){this.row=0,this.col=0,this.num=0,this.type=10,this.typeExtData=0}var n=r.prototype;return n.ResetData=function(){this.num=0,this.type=10,this.typeExtData=0},n.GetRowCol=function(){return new e(this.row,this.col)},n.equals=function(r){return void 0!==r&&null!=r&&(this.row===r.row&&this.col===r.col&&this.num===r.num)},n.Clone=function(){var e=new r;return e.row=this.row,e.col=this.col,e.num=this.num,e.type=this.type,e.typeExtData=this.typeExtData,e},r.findIndexInArray=function(r,e){return r.findIndex((function(r){return r.equals(e)}))},r}(),s=function(){this.cubeRc=new e(0,0),this.mergeRcs=[]};self.onmessage=function(r){var e=r.data,n=e.type,t=e.taskId,a=e.data,o=e.args;try{switch(n){case"CALCULATE":!function(r){var e=r.rowCfg,n=r.colCfg,t=r.calcIndex;c=e,y=n,h=t}(o);for(var u=JSON.parse(a.encodeData),i=a.start;i<=a.end;i++)L(h,u[i-a.start]);var f=JSON.stringify(u);self.postMessage({type:"RESULT",taskId:t,success:!0,data:f});break;case"TERMINATE":self.close()}}catch(r){self.postMessage({type:"ERROR",taskId:t,success:!1,error:r})}};var c=0,y=0,h=0,x=Array.from({length:c},(function(){return Array(y).fill(null)})),v=[],p=[];function w(r,n,t){var a=new e(t.x,t.y);if(n.equals(r))return a;var o=new e(n.x-r.x,n.y-r.y);return a=new e(t.x+o.x,t.y+o.y)}function m(r,n,t){var a=new e(t.x,t.y);return n.equals(r)||(n.x!=r.x?t.y==r.y&&(n.x<r.x&&t.x<r.x?a.x-=r.x-n.x:n.x>r.x&&t.x>r.x&&(a.x+=n.x-r.x)):t.x==r.x&&(n.y<r.y&&t.y<r.y?a.y-=r.y-n.y:n.y>r.y&&t.y>r.y&&(a.y+=n.y-r.y))),a}function g(r){return r.x>=0&&r.x<c&&r.y>=0&&r.y<y}function T(r,n,t,a){var o=new Array;if(!g(new e(r,n)))return o;for(var u=function(){for(var r=new Array,e=0;e<x.length;++e){for(var n=new Array,t=0;t<x[e].length;++t){var a=new l;a.row=x[e][t].row,a.col=x[e][t].col,a.num=x[e][t].num,a.type=x[e][t].type,a.typeExtData=x[e][t].typeExtData,n.push(a)}r.push(n)}return r}(),i=c,f=y,s=function(e){if(-1!==a.findIndex((function(n){return n.x===r&&n.y===e})))return 0;var n=u[r][e];return n.num>0?(n.num==t&&o.push(n.Clone()),0):void 0},h=n-1;h>=0&&0!==s(h);--h);for(var v=function(e){if(-1!==a.findIndex((function(n){return n.x===r&&n.y===e})))return 0;var n=u[r][e];return n.num>0?(n.num==t&&o.push(n.Clone()),0):void 0},p=n+1;p<f&&0!==v(p);++p);for(var w=function(r){if(-1!==a.findIndex((function(e){return e.x===r&&e.y===n})))return 0;var e=u[r][n];return e.num>0?(e.num==t&&o.push(e.Clone()),0):void 0},m=r-1;m>=0&&0!==w(m);--m);for(var T=function(r){if(-1!==a.findIndex((function(e){return e.x===r&&e.y===n})))return 0;var e=u[r][n];return e.num>0?(e.num==t&&o.push(e.Clone()),0):void 0},O=r+1;O<i&&0!==T(O);++O);return o}function O(r){var n=new Array;if(!g(new e(r.row,r.col))||0==r.num)return n;for(var t=c,a=y,o=r.row,u=r.col,i=u-1;i>=0&&0!=x[o][i].num;--i)n.push(x[o][i].Clone());for(var f=u+1;f<a&&0!=x[o][f].num;++f)n.push(x[o][f].Clone());for(var l=o-1;l>=0&&0!=x[l][u].num;--l)n.push(x[l][u].Clone());for(var s=o+1;s<t&&0!=x[s][u].num;++s)n.push(x[s][u].Clone());return n}function R(r){var n=new Array;if(0==r.num)return n;for(var t=c,a=y,o=r.row,u=r.col,f=new e(-1,-1),l=0,s=u-1;s>=0;--s){for(var h=x[o][s],p=!1,w=0;w<v.length;++w)if(!v[w].isDirH()&&v[w].rc1.equals(new e(o,s))){p=!0;break}if(p)break;if(f.equals(new e(-1,-1))&&(h.type==i.ICE||h.type==i.VINE))break;if(0==h.num&&f.equals(new e(-1,-1))&&(f=new e(o,s)),!f.equals(new e(-1,-1))){if(h.num>0)break;l++}}for(var m=1;m<=l;++m)n.push(new e(o,u-m));f=new e(-1,-1),l=0;for(var g=u+1;g<a;++g){for(var T=x[o][g],O=!1,R=0;R<v.length;++R)if(!v[R].isDirH()&&v[R].rc2.equals(new e(o,g))){O=!0;break}if(O)break;if(f.equals(new e(-1,-1))&&(T.type==i.ICE||T.type==i.VINE))break;if(0==T.num&&f.equals(new e(-1,-1))&&(f=new e(o,g)),!f.equals(new e(-1,-1))){if(T.num>0)break;l++}}for(var E=1;E<=l;++E)n.push(new e(o,u+E));f=new e(-1,-1),l=0;for(var C=o-1;C>=0;--C){for(var I=x[C][u],d=!1,b=0;b<v.length;++b)if(v[b].isDirH()&&v[b].rc1.equals(new e(C,u))){d=!0;break}if(d)break;if(f.equals(new e(-1,-1))&&(I.type==i.ICE||I.type==i.VINE))break;if(0==I.num&&f.equals(new e(-1,-1))&&(f=new e(C,u)),!f.equals(new e(-1,-1))){if(I.num>0)break;l++}}for(var M=1;M<=l;++M)n.push(new e(o-M,u));f=new e(-1,-1),l=0;for(var G=o+1;G<t;++G){for(var N=x[G][u],D=!1,A=0;A<v.length;++A)if(v[A].isDirH()&&v[A].rc2.equals(new e(G,u))){D=!0;break}if(D)break;if(f.equals(new e(-1,-1))&&(N.type==i.ICE||N.type==i.VINE))break;if(0==N.num&&f.equals(new e(-1,-1))&&(f=new e(G,u)),!f.equals(new e(-1,-1))){if(N.num>0)break;l++}}for(var B=1;B<=l;++B)n.push(new e(o+B,u));return n}function E(r){return r>0}function C(r,n){var t=[];return r>0&&null!=x[r-1][n]&&x[r-1][n].type==i.BOX2&&t.push(new e(r-1,n)),r<c-1&&null!=x[r+1][n]&&x[r+1][n].type==i.BOX2&&t.push(new e(r+1,n)),n>0&&null!=x[r][n-1]&&x[r][n-1].type==i.BOX2&&t.push(new e(r,n-1)),n<y-1&&null!=x[r][n+1]&&x[r][n+1].type==i.BOX2&&t.push(new e(r,n+1)),t}function I(r,e,n){var t=[];if(null==r)return t;var o=r.row,u=r.col;if(e==a.TOP)for(var i=o;i>=0;--i){var f=x[i][u];if(null==f||!E(f.num))break;if(!(l.findIndexInArray(n,f)>=0)){t.push(f),n.push(f);for(var s=0;s<p.length;++s){var h=p[s];if(h.rc1.equals(f.GetRowCol())||h.rc2.equals(f.GetRowCol())){var v=h.rc1.equals(f.GetRowCol())?x[h.rc2.x][h.rc2.y]:x[h.rc1.x][h.rc1.y];if(l.findIndexInArray(n,v)>=0)continue;for(var w=I(v,e,n),m=0;m<w.length;++m)t.push(w[m]),n.push(w[m])}}}}else if(e==a.RIGHT)for(var g=u;g<y;++g){var T=x[o][g];if(null==T||!E(T.num))break;if(!(l.findIndexInArray(n,T)>=0)){t.push(T),n.push(T);for(var O=0;O<p.length;++O){var R=p[O];if(R.rc1.equals(T.GetRowCol())||R.rc2.equals(T.GetRowCol())){var C=R.rc1.equals(T.GetRowCol())?x[R.rc2.x][R.rc2.y]:x[R.rc1.x][R.rc1.y];if(l.findIndexInArray(n,C)>=0)continue;for(var d=I(C,e,n),b=0;b<d.length;++b)t.push(d[b]),n.push(d[b])}}}}else if(e==a.BOTTOM)for(var M=o;M<c;++M){var G=x[M][u];if(null==G||!E(G.num))break;if(!(l.findIndexInArray(n,G)>=0)){t.push(G),n.push(G);for(var N=0;N<p.length;++N){var D=p[N];if(D.rc1.equals(G.GetRowCol())||D.rc2.equals(G.GetRowCol())){var A=D.rc1.equals(G.GetRowCol())?x[D.rc2.x][D.rc2.y]:x[D.rc1.x][D.rc1.y];if(l.findIndexInArray(n,A)>=0)continue;for(var B=I(A,e,n),L=0;L<B.length;++L)t.push(B[L]),n.push(B[L])}}}}else if(e==a.LEFT)for(var q=u;q>=0;--q){var k=x[o][q];if(null==k||!E(k.num))break;if(!(l.findIndexInArray(n,k)>=0)){t.push(k),n.push(k);for(var F=0;F<p.length;++F){var H=p[F];if(H.rc1.equals(k.GetRowCol())||H.rc2.equals(k.GetRowCol())){var P=H.rc1.equals(k.GetRowCol())?x[H.rc2.x][H.rc2.y]:x[H.rc1.x][H.rc1.y];if(l.findIndexInArray(n,P)>=0)continue;for(var U=I(P,e,n),X=0;X<U.length;++X)t.push(U[X]),n.push(U[X])}}}}return t}function d(r){for(var e=R(r),n=new u(r.row,r.row,r.col,r.col),t=0;t<e.length;++t){var a=e[t];a.x<n.minRow&&(n.minRow=a.x),a.x>n.maxRow&&(n.maxRow=a.x),a.y<n.minCol&&(n.minCol=a.y),a.y>n.maxCol&&(n.maxCol=a.y)}return n}function b(){p=[];for(var r=0;r<c;++r)for(var n=0;n<y;++n){var a=x[r][n];if(!(null==a||a.num<=0)){var u=new e(r,n);if(a.type==i.GLUETOP){var f=new e(r-1,n);if(g(f)&&null!=x[f.x][f.y]&&x[f.x][f.y].num>0){var l=new o(f,u,t.BOTTOM,t.TOP);p.push(l)}}else if(a.type==i.GLUELEFT){var s=new e(r,n-1);if(g(s)&&null!=x[s.x][s.y]&&x[s.x][s.y].num>0){var h=new o(s,u,t.RIGHT,t.LEFT);p.push(h)}}}}}function M(r,e,n){if(!g(r))return!1;var t=x[r.x][r.y];if(0==t.num)return!1;if(t.type==i.BOX2)return!1;if(T(r.x,r.y,t.num,new Array).length>0&&(e.push(r),!n))return!0;var o=O(t),u=f(o);u.push(t);for(var l=new Array,s=0;s<u.length;++s)l.push(u[s].GetRowCol());var c=R(t),y=p.length>0;if(y&&c.length>0){for(var h=function(r){for(var e=d(r),n=a.TOP;n<=a.LEFT;++n)for(var t=I(r,n,[]),o=0;o<t.length;++o){var u=t[o];if(n==a.TOP){var i=d(u),f=u.row-i.minRow;f<r.row-e.minRow&&(e.minRow=r.row-f)}else if(n==a.BOTTOM){var l=d(u).maxRow-u.row;l<e.maxRow-r.row&&(e.maxRow=r.row+l)}else if(n==a.LEFT){var s=d(u),c=u.col-s.minCol;c<r.col-e.minCol&&(e.minCol=r.col-c)}else if(n==a.RIGHT){var y=d(u).maxCol-u.col;y<e.maxCol-r.col&&(e.maxCol=r.col+y)}}return e}(t),v=[],E=0;E<c.length;++E){var C=c[E];(C.x<h.minRow||C.x>h.maxRow||C.y<h.minCol||C.y>h.maxCol)&&v.push(E)}for(;v.length>0;){var b=v.pop();c.splice(b,1)}}for(var M=0;M<c.length;++M){var G=c[M];if(y){if(G.x<t.row){o=I(t,a.TOP,[])}else if(G.x>t.row){o=I(t,a.BOTTOM,[])}else if(G.y<t.col){o=I(t,a.LEFT,[])}else if(G.y>t.col){o=I(t,a.RIGHT,[])}u=f(o)}for(var N=new Array,D=0;D<o.length;++D){var A=o[D].GetRowCol(),B=m(r,G,A);y&&(B=w(r,G,A)),N.push(B)}if(g(G)){for(var L=T(G.x,G.y,t.num,N),q=function(r){var e=L.findIndex((function(e){return e.equals(u[r])}));-1!==e&&L.splice(e,1)},k=0;k<u.length;++k)q(k);if(L.length>0&&(e.push(G),!n))return!0}}return e.length>0}function G(r){return r==i.BOARDLEFT||r==i.BOARDRIGHT||r==i.BOARDTOP||r==i.BOARDBOTTOM}function N(n,t){for(var o=new Array,u=0;u<c;++u)for(var f=0;f<y;++f){var l=new Array;if(M(new e(u,f),l,!0)){var h=new s;h.cubeRc=new e(u,f),h.mergeRcs=l,o.push(h)}}if(o.length>0){for(;n>=t.canMergeCubeNums.length;)t.canMergeCubeNums.push([]);t.canMergeCubeNums[n].push(o.length);var R=o[r(0,o.length)],E=R.cubeRc,d=R.mergeRcs,A=d[r(0,d.length)],B=x[R.cubeRc.x][R.cubeRc.y],L=O(B),q=p.length>0&&!A.equals(E);if(q)if(A.x<E.x){L=I(B,a.TOP,[])}else if(A.x>E.x){L=I(B,a.BOTTOM,[])}else if(A.y<E.y){L=I(B,a.LEFT,[])}else if(A.y>E.y){L=I(B,a.RIGHT,[])}for(var k=0;k<L.length;++k)if(L[k].num<=0){if(A.x<E.x){L=I(B,a.LEFT,[])}else if(A.x>E.x){L=I(B,a.RIGHT,[])}else if(A.y<E.y){L=I(B,a.TOP,[])}else if(A.y>E.y){L=I(B,a.BOTTOM,[])}break}for(var F=x[E.x][E.y].Clone(),H=[],P=0;P<L.length;++P)H.push(L[P].Clone());x[E.x][E.y].ResetData();for(var U=0;U<L.length;++U){var X=L[U].GetRowCol();x[X.x][X.y].ResetData()}x[A.x][A.y]=F,x[A.x][A.y].row=A.x,x[A.x][A.y].col=A.y;for(var V=0;V<H.length;++V){var S=m(E,A,H[V].GetRowCol());q&&(S=w(E,A,H[V].GetRowCol())),g(S)&&(H[V].num,x[S.x][S.y]=H[V],x[S.x][S.y].row=S.x,x[S.x][S.y].col=S.y)}b();var _=T(A.x,A.y,x[A.x][A.y].num,new Array);if(_.length>0){var j=_[r(0,_.length)].GetRowCol(),J=0;x[j.x][j.y].type==i.NONE||G(x[j.x][j.y].type)||J++,x[A.x][A.y].type==i.NONE||G(x[A.x][A.y].type)||J++,D(x[j.x][j.y]),D(x[A.x][A.y]),x[j.x][j.y].ResetData(),x[A.x][A.y].ResetData();var W=0;W=(E.x,A.x,Math.abs(E.y-A.y));var K=0;K=A.x==j.x?Math.abs(A.y-j.y)-1:Math.abs(A.x-j.x)-1,K=Math.max(0,K),t.gameScoreTmp+=1+W+K,_.length>1&&(t.multipleTimes+=1),t.gameMergeTimes+=1,A.equals(E)?t.tapMergeTimes++:t.moveMergeTimes++,1==o.length&&1==_.length&&t.leftOnePairTimes++;for(var z=C(A.x,A.y),Q=C(j.x,j.y),Y=0;Y<Q.length;++Y)e.findIndexInArray(z,Q[Y])<0&&z.push(Q[Y]);for(var Z=0,$=0;$<z.length;++$){var rr=z[$],er=x[rr.x][rr.y];null!=er&&er.type==i.BOX2&&(er.typeExtData<=1?(x[rr.x][rr.y].ResetData(),Z++):(er.typeExtData-=1,Z++))}for(var nr,tr=[],ar=0;ar<v.length;++ar){var or=v[ar],ur=!1;or.isDirH()?or.rc1.y==A.y&&or.rc2.y==j.y&&(A.x<j.x&&A.x<=or.rc1.x&&j.x>=or.rc2.x||A.x>j.x&&A.x>=or.rc2.x&&j.x<=or.rc1.x)&&(ur=!0):or.rc1.x==A.x&&or.rc2.x==j.x&&(A.y<j.y&&A.y<=or.rc1.y&&j.y>=or.rc2.y||A.y>j.y&&A.y>=or.rc2.y&&j.y<=or.rc1.y)&&(ur=!0),ur&&tr.push(ar)}for(nr=tr.length;tr.length>0;){var ir=tr.pop();v.splice(ir,1)}0==t.mergeDebuffRecord.length&&(t.mergeDebuffRecord=new Array(c*y/2).fill(0)),(J>0||Z>0)&&(t.mergeDebuffRecord[t.gameMergeTimes-1]+=1),nr>0&&(t.mergeDebuffRecord[t.gameMergeTimes-1]+=nr),t.gameMergeTimes%3==0&&function(){var e=function(r){for(var e=[],n=0;n<x.length;++n)for(var t=0;t<x[n].length;++t){var a=x[n][t];null!=a&&a.type==r&&e.push(a)}return e}(i.VINE);if(0==e.length)return;for(var n=function(){for(var r=[],e=0;e<x.length;++e)for(var n=0;n<x[e].length;++n){var t=x[e][n];null!=t&&t.num>0&&r.push(t)}return r}().filter((function(r){return null!=r&&r.type===i.NONE})),t=function(){if(0==n.length)return 1;var t=r(0,n.length),o=n[t];o.type=i.VINE,e[a].type=i.NONE,n=n.filter((function(r){return null!=r&&r.num!=o.num}))},a=0;a<e.length&&!t();++a);}()}b(),N(n,t)}}function D(r){if(null!=r){for(var e=r.GetRowCol(),n=[],t=0;t<p.length;++t)(p[t].rc1.equals(e)||p[t].rc2.equals(e))&&n.push(t);for(;n.length>0;){var a=n.pop(),o=p[a],u=o.rc1,f=o.rc2;null!=x[u.x][u.y]&&(x[u.x][u.y].type=i.NONE),null!=x[f.x][f.y]&&(x[f.x][f.y].type=i.NONE),p.splice(a,1)}}}function A(r,a){!function(r){B(r);for(var e=function(){for(var r=new Array,e=0;e<c;++e)for(var n=0;n<y;++n)r.push(x[e][n]);return r}(),n=0;n<e.length-1;++n){var t=e[n];if(0!=t.num)for(var a=n+1;a<e.length;++a){var o=e[a];if(0!=o.num){var u=1==Math.abs(t.col-o.col)&&t.row==o.row,f=1==Math.abs(t.row-o.row)&&t.col==o.col,l=!0;if(t.type!=i.BOX2&&o.type!=i.BOX2||(l=!1),t.num==o.num&&(u||f)&&l){r.initMergeNum+=1,(t.type==i.ICE||o.type==i.ICE||t.type==i.VINE||o.type==i.VINE||t.type>=i.GLUELEFT&&t.type<=i.GLUEBOTTOM||o.type>=i.GLUELEFT&&o.type<=i.GLUEBOTTOM)&&(r.firstCanMergeDebuff+=1),x[t.row][t.col].ResetData(),x[o.row][o.col].ResetData();break}}}}}(a),B(a),v=[];for(var u=0;u<a.boardData.length;++u){var f=a.boardData[u],l=new n(new e(f.rc1.x,f.rc1.y),new e(f.rc2.x,f.rc2.y));v.push(l)}p=function(r){for(var n=[],a=[],u=0;u<r.length;++u)a.push(r[u]);for(var f=0;f<a.length;++f){var l=Math.floor(f/y),s=f-l*y,c=new e(l,s);if(a[f]==i.GLUETOP){var h=new e(l-1,s);if(g(h)){var x=new o(h,c,t.BOTTOM,t.TOP);n.push(x)}}else if(a[f]==i.GLUELEFT){var v=new e(l,s-1);if(g(v)){var p=new o(v,c,t.RIGHT,t.LEFT);n.push(p)}}}return n}(a.extData);var s=a.tapMergeTimes,h=a.moveMergeTimes,w=a.leftOnePairTimes;N(r,a);for(var m=0,T=0;T<c;++T)for(var O=0;O<y;++O)null!=x[T][O]&&x[T][O].num>0&&x[T][O].type!=i.BOX2&&m++;if(0==m)a.winTimes++,a.gameScoreTotal+=a.gameScoreTmp;else{for(;r>=a.canMergeCubeNums.length;)a.canMergeCubeNums.push([]);if(a.canMergeCubeNums[r].length<a.nums.length/2)for(var R=a.canMergeCubeNums[r].length;R<a.nums.length/2;++R)a.canMergeCubeNums[r].push(0);a.leftCubes+=m,a.tapMergeTimes=s,a.moveMergeTimes=h,a.leftOnePairTimes=w}a.gameScoreTmp=0}function B(r){!function(r){if(x=[],r)for(var e=0;e<c;++e){for(var n=new Array,t=0;t<y;++t){var a=new l;a.row=e,a.col=t,a.ResetData(),n.push(a)}x.push(n)}}(!0);for(var e=0;e<c;++e)for(var n=0;n<y;++n){var t=e*y+n;if(t<r.nums.length){var a=r.nums[t],o=new l;o.row=e,o.col=n,o.num=a,o.type=r.extData[t],o.type==i.BOX2&&(o.typeExtData=2),x[e][n]=o}}}function L(r,e){e.gameMergeTimes=0,A(r,e)}}.toString(),t=n.substring(n.indexOf("{")+1,n.lastIndexOf("}")),a=new Blob([t],{type:"application/javascript"});r("default",URL.createObjectURL(a));e._RF.pop()}}}));

System.register("chunks:///_virtual/TableCreator.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Log.ts","./TableGenerateWokerManager.ts","./DeepClone.ts","./TableCalcWokerManager.ts","./CommonUtils.ts","./yx-collection-view.ts","./yx-table-layout.ts","./UI_GameMap.ts","./GameMacros.ts","./UIHelp.ts"],(function(e){var t,a,r,n,i,s,l,o,h,u,c,C,g,f,T,b,p,m,v,d,w,S,y,G,x,I,k,D,R,E,M,A,N,P,O;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,i=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){l=e.cclegacy,o=e._decorator,h=e.Node,u=e.EditBox,c=e.Label,C=e.Prefab,g=e.Vec2,f=e.instantiate,T=e.Size,b=e.UITransform,p=e.Vec3,m=e.tween,v=e.sys,d=e.randomRangeInt,w=e.Button,S=e.EventHandler,y=e.Toggle,G=e.Component},function(e){x=e.default},function(e){I=e.TableGenerateWokerManager},function(e){k=e.DeepClone},function(e){D=e.TableCalcWokerManager},function(e){R=e.CommonUtils},function(e){E=e.YXCollectionView},function(e){M=e.YXTableLayout},function(e){A=e.UI_GameMap},function(e){N=e.CardPlayType,P=e.GameMacros},function(e){O=e.default}],execute:function(){var B,L,U,F,z,j,V,W,_,H,X,q,J,Y,K,Z,Q,$,ee,te,ae,re,ne,ie,se,le,oe,he,ue,ce,Ce,ge,fe,Te,be,pe,me;l._RF.push({},"a3987PsT+NL+4VcP+zvRyXZ","TableCreator",void 0);var ve=o.ccclass,de=o.property,we=e("TableData",(function(){this.nums=new Array,this.extData=new Array,this.boardData=new Array,this.winTimes=0,this.leftCubes=0,this.initMergeNum=0,this.multipleTimes=0,this.gameScoreTmp=0,this.gameScoreTotal=0,this.gameMergeTimes=0,this.leftOnePairTimes=0,this.tapMergeTimes=0,this.moveMergeTimes=0,this.firstCanMergeDebuff=0,this.winTimesAvg=0,this.leftCubesAvg=0,this.initMergeNumberAvg=0,this.multipleTimesAvg=0,this.leftOnePairTimesAvg=0,this.tapMergeTimesAvg=0,this.moveMergeTimesAvg=0,this.firstCanMergeDebuffAvg=0,this.canMergeCubeNums=[],this.canMergeCubeNumsAvg=[],this.mergeDebuffRecord=[]})),Se=e("TableBoardInfo",function(){function e(e,t){this.rc1=new g(-1,-1),this.rc2=new g(-1,-1),this.rc1=e,this.rc2=t}return e.prototype.isDirH=function(){return this.rc1.x!=this.rc2.x&&this.rc1.y==this.rc2.y},e}()),ye=function(e){return e[e.NONE=10]="NONE",e[e.ICE=11]="ICE",e[e.VINE=12]="VINE",e[e.BOX2=13]="BOX2",e[e.BOARD=14]="BOARD",e[e.GLUE=15]="GLUE",e}(ye||{}),Ge=function(e){return e[e.NONE=0]="NONE",e[e.Generate=1]="Generate",e[e.Cacl=2]="Cacl",e}(Ge||{}),xe=function(e){return e[e.STOPED=0]="STOPED",e[e.STARTED=1]="STARTED",e}(xe||{}),Ie=function(){function e(){this.row=0,this.col=0,this.num=0,this.type=10,this.typeExtData=0}var t=e.prototype;return t.ResetData=function(){this.num=0,this.type=10,this.typeExtData=0},t.GetRowCol=function(){return new g(this.row,this.col)},t.equals=function(e){return void 0!==e&&null!=e&&(this.row===e.row&&this.col===e.col&&this.num===e.num)},t.Clone=function(){var t=new e;return t.row=this.row,t.col=this.col,t.num=this.num,t.type=this.type,t.typeExtData=this.typeExtData,t},e}();e("TableCreator",(B=ve("TableCreator"),L=de({type:h}),U=de({type:h}),F=de({type:u}),z=de({type:u}),j=de({type:u}),V=de({type:u}),W=de({type:u}),_=de({type:u}),H=de({type:u}),X=de({type:h}),q=de({type:c}),J=de({type:u}),Y=de({type:h}),K=de({type:A}),Z=de({type:u}),Q=de({type:C}),$=de({type:h}),B((ae=t((te=function(e){function t(){for(var t,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))||this).RowCfg=0,t.ColCfg=0,t.NumberTypeCount=0,t.SingleNumberCount=0,t.InitRowCount=0,t.InitColCount=0,t.CreateTablesCount=0,t.IsForceStopCalc=!1,r(t,"ToastContent",ae,n(t)),r(t,"ToastItem",re,n(t)),r(t,"InputRow",ne,n(t)),r(t,"InputCol",ie,n(t)),r(t,"InputNumberTypeCount",se,n(t)),r(t,"InputSingleNumberCount",le,n(t)),r(t,"InputInitRowCount",oe,n(t)),r(t,"InputInitColCount",he,n(t)),r(t,"InputCreateTablesCount",ue,n(t)),r(t,"TableCreatorMask",ce,n(t)),r(t,"LabelTableCreatorProgress",Ce,n(t)),r(t,"InputCalcTotalCount",ge,n(t)),r(t,"TableListView",fe,n(t)),r(t,"GameMapLayer",Te,n(t)),t.GenerateBatchSize=100,t.GenerateCompletedTasks=0,t.GenerateTableResults=[],t.GenerateTableExtData=[],t.GenerateTablBoardData=[],t.CalcBatchSize=10,t.CalcCompletedTask=0,t.CalcSingleTimes=1,t.CalcTableDatas=new Array,t.CurrentTaskType=Ge.NONE,t.CurrentTaskState=xe.STOPED,t.WebFileInput=null,r(t,"InputCubeTypeGenCount",be,n(t)),t.CurrentMahjongSpecialType=ye.NONE,t.CurrentMahjongSpecialCount=4,r(t,"PrefabButtonCardSelect",pe,n(t)),r(t,"LayoutCardList",me,n(t)),t.AllButtonCardSelect=[],t.CurrentSelectCard=null,t.CurrentSelectTableIndex=-1,t}a(t,e);var l=t.prototype;return l.onLoad=function(){this.UpdateTableListView(),this.InitCardsSelectLayer()},l.start=function(){},l.update=function(e){},l.onDestroy=function(){this.FinishAllGenerateWorks()},l.GetAndCheckAllConfig=function(){var e=parseInt(this.InputRow.string);if(e<=0)return this.ShowToast("行配置输入错误！"),!1;this.RowCfg=e;var t=parseInt(this.InputCol.string);if(t<=0)return this.ShowToast("列配置输入错误！"),!1;this.ColCfg=t;var a=parseInt(this.InputNumberTypeCount.string);if(a<=0)return this.ShowToast("数字种类配置错误！"),!1;this.NumberTypeCount=a;var r=parseInt(this.InputSingleNumberCount.string);if(r<=0||r*this.NumberTypeCount!=this.RowCfg*this.ColCfg)return this.ShowToast("单个数字出现的次数配置错误！"),!1;this.SingleNumberCount=r;var n=parseInt(this.InputInitRowCount.string);if(n<=0)return this.ShowToast("初始横向配置错误！"),!1;this.InitRowCount=n;var i=parseInt(this.InputInitColCount.string);if(i<=0)return this.ShowToast("初始纵向配置错误！"),!1;if(this.InitColCount=i,2*this.InitRowCount+2*this.InitColCount>this.RowCfg*this.ColCfg)return this.ShowToast("初始横向和纵向配对个数错误！"),!1;var s=parseInt(this.InputCubeTypeGenCount.string);return this.CurrentMahjongSpecialType!==ye.NONE&&(s<=0||s>8)?(this.ShowToast("特殊块配置数量错误！"),!1):(this.CurrentMahjongSpecialCount=s,!0)},l.ShowToast=function(e,t){if(void 0===t&&(t=0),e){var a=f(this.ToastItem);a.getChildByName("LabelToast").getComponent(c).string=e,this.ToastContent.addChild(a);var r=new T(a.getComponent(b).contentSize);r.width=0,r.height=0;var n=new p(a.scale);n.x=0,n.y=0,m(a.getComponent(b)).delay(t).delay(1.5).to(.3,{contentSize:r}).start(),m(a).delay(t).call((function(){a.active=!0})).delay(1.5).to(.3,{scale:n}).removeSelf().start()}},l.OnBtnCreateClicked=function(){if(this.GetAndCheckAllConfig()){var e=parseInt(this.InputCreateTablesCount.string);e<=0?this.ShowToast("需要生成的阵型数量配置错误！"):(this.CreateTablesCount=e,this.StartGenerateTables())}},l.OnBtnDownloadTables=function(){if(0!=this.GenerateTableResults.length){var e=this.GetAllGenerateTablesString(),t=new Blob([e],{type:"application/json"}),a=document.createElement("a");a.download="生成阵型-"+this.CreateTablesCount.toString()+"关.xlsx",a.href=URL.createObjectURL(t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)}else this.ShowToast("没有可下载数据！")},l.GetAllGenerateTablesString=function(){var e="";if(this.GenerateTableResults.length!==this.GenerateTableExtData.length)return this.ShowToast("生成数据出错！无法下载！"),e;for(var t=0;t<this.GenerateTableResults.length;++t){var a=this.GenerateTableResults[t],r=this.GenerateTableExtData[t];e+="[";for(var n=0;n<a.length;++n)this.CurrentMahjongSpecialType==ye.NONE?e+=a[n].toString():(e+=r[n].toString(),e+=a[n].toString().padStart(2,"0")),n<a.length-1&&(e+=",");e+="]",t<this.GenerateTableResults.length-1&&(e+="\n")}return e},l.OnBtnUploadTables=function(){this.InitUploadElement(),this.WebFileInput.click()},l.InitUploadElement=function(){var e=this;v.platform!==v.Platform.DESKTOP_BROWSER&&v.platform!==v.Platform.MOBILE_BROWSER||(null!=this.WebFileInput&&(document.body.removeChild(this.WebFileInput),this.WebFileInput=null),this.WebFileInput=document.createElement("input"),this.WebFileInput.type="file",this.WebFileInput.accept=".xlsx",this.WebFileInput.style.display="none",document.body.appendChild(this.WebFileInput),this.WebFileInput.onchange=function(t){var a=t.target.files[0],r=new FileReader;r.onload=function(){var t=r.result;e.ParseUploadTableData(t.toString())},r.readAsText(a)})},l.ParseUploadTableData=function(e){if(this.GetAndCheckAllConfig()||this.ShowToast("生成阵型参数错误，无法计算！"),R.isNull(e))this.ShowToast("数据错误，上传阵型失败！");else{var t=(e=(e=e.replaceAll('"',"")).replaceAll("\r","")).split("\n"),a=e.split(" ");if(t.length<=0&&a.length<=0)this.ShowToast("数据错误，上传阵型失败！");else{var r=t.length>a.length?t:a;this.GenerateTableResults=[],this.GenerateTableExtData=[];for(var n=0;n<r.length;++n)if(""!=r[n]){for(var i=[],s=[],l=JSON.parse(r[n]),o=0;o<l.length;++o){var h=l[o];h<1e3&&(h+=1e3);var u=h.toString();if(4!=u.length&&2!=u.length)return this.GenerateTableResults=[],this.GenerateTableExtData=[],void this.ShowToast("数据错误，上传阵型数值长度不为4！");i.push(parseInt(u.substring(0,2))),s.push(parseInt(u.substring(2)))}if(this.GenerateTableExtData.push(i),this.GenerateTableResults.push(s),s.length!==i.length||s.length!==this.RowCfg*this.ColCfg)return this.GenerateTableResults=[],this.GenerateTableExtData=[],void this.ShowToast("数据错误，上传阵型与生成阵型配置不符！")}for(var c=!1,C=0;C<this.GenerateTableExtData.length;++C){for(var g=0;g<this.GenerateTableExtData[C].length;++g)if(10!=this.GenerateTableExtData[C][g]){c=!0;break}if(c)break}c||this.ProgressGenerateExtData(),this.UpdateTableListView(),this.ShowToast("上传阵型成功，并已处理为对应特殊阵型")}}},l.OnBtnVerifyClicked=function(){this.GameTableVerify()},l.GameTableVerify=function(){var e=this;if(this.GenerateTableResults.length<=0)this.ShowToast("对不起，没有找到有效的阵型数据！");else{for(var t=new Array,a=function(a){for(var n=e.GenerateTableResults[a],i=(n.length,e.SingleNumberCount,function(r){if(n.filter((function(e){return e==n[r]})).length!=e.SingleNumberCount)return t.push(a+1),a=e.GenerateTableResults.length,1}),s=0;s<n.length&&!i(s);++s);r=a},r=0;r<this.GenerateTableResults.length;++r)a(r);if(t.length>0){for(var n="",i=0;i<t.length;++i)n+=t[i].toString(),n+=",";this.ShowToast("非法阵型: "+n)}else this.ShowToast("校验完成，未发现非法阵型！")}},l.OnBtnDownloadCalcData=function(){if(0!=this.CalcTableDatas.length){var e=this.GetAllCalcTablesString(),t=new Blob([e],{type:"application/json"}),a=document.createElement("a");a.download="通关数据-"+this.CreateTablesCount.toString()+"关.xlsx",a.href=URL.createObjectURL(t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)}else this.ShowToast("未找到计算数据！")},l.GetAllCalcTablesString=function(){for(var e="特殊块类型\t特殊块数量\t阵型\t通关率\t初始相邻消除对数\t失败时剩余对数\t初始可消除的debuff数量\t胜局仅一对可消除次数\t胜局点击消除次数\t胜局移动消除次数\t多选触发率",t=0;t<this.RowCfg*this.ColCfg/2;++t)e+="\t",e+="step"+(t+1).toString();if(this.CalcTableDatas.length>0)for(var a=0;a<this.CalcTableDatas[0].nums.length/2;++a)e+="\t",e+="step"+(a+1).toString();e+="\t胜局平均得分",e+="\n";for(var r=0;r<this.CalcTableDatas.length;++r){e+=this.CurrentMahjongSpecialType,e+="\t",e+=this.CurrentMahjongSpecialCount,e+="\t";var n=this.CalcTableDatas[r],i=this.GenerateTableExtData[r];e+="[";for(var s=0;s<n.nums.length;++s)this.CurrentMahjongSpecialType==ye.NONE?e+=n.nums[s].toString():(e+=i[s].toString(),e+=n.nums[s].toString().padStart(2,"0")),s<n.nums.length-1&&(e+=",");e+="]",e+="\t",e+=n.winTimesAvg.toFixed(2),e+="%",e+="\t",e+=n.initMergeNumberAvg.toFixed(2),e+="\t",e+=n.leftCubesAvg.toFixed(2),e+="\t",e+=n.firstCanMergeDebuffAvg.toFixed(2),e+="\t",e+=n.leftOnePairTimesAvg.toFixed(2),e+="\t",e+=n.tapMergeTimesAvg.toFixed(2),e+="\t",e+=n.moveMergeTimesAvg.toFixed(2),e+="\t",e+=n.multipleTimesAvg.toFixed(2);for(var l=0;l<n.mergeDebuffRecord.length;++l)e+="\t",e+=n.mergeDebuffRecord[l];for(var o=0;o<n.nums.length/2;++o)e+="\t",e+=n.canMergeCubeNumsAvg[o].toFixed(2);e+="\t",n.winTimes>0?e+=(n.gameScoreTotal/n.winTimes).toFixed(2):e+="0",r<this.CalcTableDatas.length-1&&(e+="\n")}return e},l.OnBtnCalcClicked=function(){var e=parseInt(this.InputCalcTotalCount.string);e<=0?this.ShowToast("计算次数不能为0！"):(this.CalcSingleTimes=e,this.StartCalcTables())},l.OnBtnStopCreatorClicked=function(){this.FinishAllGenerateWorks(),this.FinishAllCalcWorks(),this.ShowTaskMask(!1)},l.FinishAllGenerateWorks=function(){I.Instance.terminateAll(),this.CurrentTaskType=Ge.NONE,this.CurrentTaskState=xe.STOPED},l.ClearTasks=function(){this.CurrentTaskState=xe.STOPED,this.CurrentTaskType=Ge.NONE},l.ClearGenerateTableDatas=function(){this.GenerateTableResults=[],this.GenerateCompletedTasks=0},l.StartGenerateTables=function(){var e=i(s().mark((function e(){var t,a,r,n,i,l,o,h,u,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.ClearGenerateTableDatas(),this.FinishAllGenerateWorks(),this.ClearTasks(),this.CurrentTaskType=Ge.Generate,this.CurrentTaskState=xe.STARTED,this.ShowTaskMask(!0),t=Date.now(),x.log("开始大规模计算:"+t.toString()),a=Math.ceil(this.CreateTablesCount/this.GenerateBatchSize),r=navigator.hardwareConcurrency||4,n=r<a?r:a,I.Instance.initWorkerPool(n),i=new Set,l=s().mark((function e(){var t,a,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.CurrentTaskState!==xe.STOPED){e.next=4;break}return c.ClearGenerateTableDatas(),c.ShowToast("生成任务已终止！"),e.abrupt("return",{v:void 0});case 4:if(t=h*c.GenerateBatchSize,a=Math.min(t+c.GenerateBatchSize-1,c.CreateTablesCount-1),(r=c.ExecGenerateBatch(t,a)).finally((function(){i.delete(r)})),i.add(r),!(i.size>=n)){e.next=12;break}return e.next=12,Promise.race(i);case 12:case"end":return e.stop()}}),e)})),h=0;case 15:if(!(h<a)){e.next=23;break}return e.delegateYield(l(),"t0",17);case 17:if(!(o=e.t0)){e.next=20;break}return e.abrupt("return",o.v);case 20:h++,e.next=15;break;case 23:return e.next=25,Promise.all(i);case 25:u=Date.now(),x.log("所有计算任务完成！:"+u.toString()+",  总耗时："+(u-t).toString()+"毫秒"),this.ShowTaskMask(!1),this.ClearTasks(),this.ProgressGenerateTableResults(),this.ShowToast("所有阵型生成完毕！",.3);case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.ExecGenerateBatch=function(){var e=i(s().mark((function e(t,a){var r,n,i,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="task-"+t+"-"+a,x.log("开始处理任务: "+r),e.prev=2,i={rowCfg:this.RowCfg,colCfg:this.ColCfg,maxCubeNum:this.NumberTypeCount,singleNumCount:this.SingleNumberCount,initRowCount:this.InitRowCount,initColCount:this.InitColCount},e.next=6,I.Instance.execTask(r,{start:t,end:a},i);case 6:l=e.sent,(n=this.GenerateTableResults).push.apply(n,l),this.GenerateCompletedTasks+=a-t+1,this.UpdateTaskProgress(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),x.error("任务 "+r+" 失败: "+e.t0);case 15:return e.abrupt("return",Promise.resolve());case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(t,a){return e.apply(this,arguments)}}(),l.ProgressGenerateTableResults=function(){this.ProgressGenerateExtData(),this.UpdateTableListView()},l.ProgressGenerateExtData=function(){this.GenerateTableExtData=[],this.CurrentMahjongSpecialType==ye.NONE?this.ProgressGamePlayNormal():this.CurrentMahjongSpecialType==ye.ICE?this.ProgressGamePlayIce():this.CurrentMahjongSpecialType==ye.VINE?this.ProgressGamePlayVine():this.CurrentMahjongSpecialType==ye.BOX2?this.ProgressGamePlayBox2():this.CurrentMahjongSpecialType==ye.BOARD?this.ProgressGamePlayBoard():this.CurrentMahjongSpecialType==ye.GLUE&&this.ProgressGamePlayGlue()},l.ProgressGamePlayNormal=function(){this.GenerateTableExtData=[];for(var e=0;e<this.GenerateTableResults.length;++e){for(var t=this.GenerateTableResults[e],a=new Array,r=0;r<t.length;++r)a.push(N.Normal);this.GenerateTableExtData.push(a)}},l.ProgressGamePlayIce=function(){this.GenerateTableExtData=[],this.ProgressGamePlayNormal();for(var e=[],t=0;t<this.GenerateTableResults.length;++t){for(var a=this.GenerateTableResults[t],r=this.GenerateTableExtData[t],n=0;n<this.CurrentMahjongSpecialCount;){var i=d(0,a.length);e.indexOf(a[i])>=0||r[i]==N.Normal&&(r[i]=N.ICE,e.push(a[i]),n++)}e=[]}},l.ProgressGamePlayVine=function(){this.GenerateTableExtData=[],this.ProgressGamePlayNormal();for(var e=[],t=0;t<this.GenerateTableResults.length;++t){for(var a=this.GenerateTableResults[t],r=this.GenerateTableExtData[t],n=0;n<this.CurrentMahjongSpecialCount;){var i=d(0,a.length);e.indexOf(a[i])>=0||r[i]==N.Normal&&(r[i]=N.VINE,e.push(a[i]),n++)}e=[]}},l.ProgressGamePlayBox2=function(){this.GenerateTableExtData=[],this.ProgressGamePlayNormal();for(var e=[],t=0;t<this.GenerateTableResults.length;++t){for(var a=this.GenerateTableResults[t],r=this.GenerateTableExtData[t],n=0,i=1e4;n<this.CurrentMahjongSpecialCount&&i>0;){i--;var s=d(0,a.length);if(!(e.indexOf(a[s])>=0)&&r[s]==N.Normal){for(var l=!1,o=Math.floor(s/this.ColCfg),h=s-o*this.ColCfg,u=0;u<r.length;++u){var c=Math.floor(u/this.ColCfg),C=u-o*this.ColCfg;if(o==c&&1==Math.abs(h-C)&&r[u]==N.BOX2){l=!0;break}if(h==C&&1==Math.abs(o-c)&&r[u]==N.BOX2){l=!0;break}}if(!l){var g=this.GetAllSameCubes(a[s],a);if(!(g.length<4)){for(var f=!1,T=0;T<g.length-1;++T){for(var b=g[T],p=Math.floor(b/this.ColCfg),m=b-p*this.ColCfg,v=T+1;v<g.length;++v){var w=g[v],S=Math.floor(w/this.ColCfg),y=w-S*this.ColCfg;if(p==S&&1==Math.abs(m-y)){f=!0;break}if(m==y&&1==Math.abs(p-S)){f=!0;break}}if(f)break}if(!f)for(var G=0;G<g.length&&G<4&&n<this.CurrentMahjongSpecialCount;++G){var x=g[G];r[x]=N.BOX2,e.push(a[x]),n++}}}}}e=[]}},l.ProgressGamePlayBoard=function(){this.GenerateTableExtData=[],this.GenerateTablBoardData=[],this.ProgressGamePlayNormal();for(var e=0;e<this.GenerateTableResults.length;++e){for(var t=this.GenerateTableResults[e],a=this.GenerateTableExtData[e],r=this.GetAllInitCanMergeCubes(t),n=1e3,i=this.CurrentMahjongSpecialCount,s=[];i>0&&n>0;){if(0!=d(0,2))for(;n>0;){for(var l=d(0,this.RowCfg-1),o=d(0,this.ColCfg),h=new g(l,o),u=new g(h.x+1,h.y),c=!1,C=0;C<s.length;++C){var f=s[C];if(f.rc1.x==h.x||f.rc2.x==h.x||f.rc1.y==h.y||f.rc2.y==h.y||f.rc1.x==u.x||f.rc2.x==u.x||f.rc1.y==u.y||f.rc2.y==u.y){c=!0;break}}for(var T=0;T<r.length;++T){var b=r[T].GetRowCol();if(b.equals(h)||b.equals(u)){c=!0;break}}if(!c){s.push(new Se(h,u));break}n--}else for(;n>0;){for(var p=d(0,this.RowCfg),m=d(0,this.ColCfg-1),v=new g(p,m),w=new g(v.x,v.y+1),S=!1,y=0;y<s.length;++y){var G=s[y];if(G.rc1.x==v.x||G.rc2.x==v.x||G.rc1.y==v.y||G.rc2.y==v.y||G.rc1.x==w.x||G.rc2.x==w.x||G.rc1.y==w.y||G.rc2.y==w.y){S=!0;break}}for(var x=0;x<r.length;++x){var I=r[x].GetRowCol();if(I.equals(v)||I.equals(w)){S=!0;break}}if(!S){s.push(new Se(v,w));break}n--}i--}if(s.length==this.CurrentMahjongSpecialCount)for(var k=0;k<s.length;++k){var D=s[k];if(D.isDirH()){for(var R=D.rc2,E=0;E<a.length;++E)if(E==R.x*this.ColCfg+R.y){a[E]=N.BOARDTOP;break}}else for(var M=D.rc2,A=0;A<a.length;++A)if(A==M.x*this.ColCfg+M.y){a[A]=N.BOARDLEFT;break}}else e--}},l.ProgressGamePlayGlue=function(){var e=this;this.GenerateTableExtData=[],this.GenerateTablBoardData=[],this.ProgressGamePlayNormal();for(var t=0;t<this.GenerateTableResults.length;++t)for(var a=this.GenerateTableResults[t],r=this.GenerateTableExtData[t],n=this.GetAllInitCanNotMergeCubes(a),i=[],s=1e4,l=this.CurrentMahjongSpecialCount,o=function(){s--;var t=d(0,n.length),a=n[t];if(i.indexOf(a.num)>=0)return 0;var o=d(N.GLUELEFT,N.GLUEBOTTOM+1);if(o==N.GLUETOP&&0==a.row)return 0;if(o==N.GLUERIGHT&&a.col==e.ColCfg-1)return 0;if(o==N.GLUEBOTTOM&&a.row==e.RowCfg-1)return 0;if(o==N.GLUELEFT&&0==a.col)return 0;var h=N.Normal,u=-1,c=-1;o==N.GLUETOP?(u=a.row-1,c=a.col,h=N.GLUEBOTTOM):o==N.GLUERIGHT?(u=a.row,c=a.col+1,h=N.GLUELEFT):o==N.GLUEBOTTOM?(u=a.row+1,c=a.col,h=N.GLUETOP):o==N.GLUELEFT&&(u=a.row,c=a.col-1,h=N.GLUERIGHT);for(var C=null,g=0;g<n.length;++g)if(n[g].row==u&&n[g].col==c){C=n[g];break}if(null==C)return 0;if(i.indexOf(C.num)>=0)return 0;i.push(a.num),i.push(C.num);var f=a.row*e.ColCfg+a.col,T=C.row*e.ColCfg+C.col;r[f]=o,r[T]=h,n=n.filter((function(e){return e.row!=a.row&&e.col!=a.col&&e.row!=u&&e.col!=c})),l--};l>0&&s>0&&n.length>0;)o()},l.GetAllCubes=function(e){for(var t=[],a=0;a<e.length;++a){var r=Math.floor(a/this.ColCfg),n=a-r*this.ColCfg,i=new Ie;i.row=r,i.col=n,i.num=e[a],t.push(i)}return t},l.GetAllInitCanNotMergeCubes=function(e){var t=[];if(e.length!=this.RowCfg*this.ColCfg)return t;for(var a=this.GetAllCubes(e),r=[],n=0;n<this.RowCfg;++n){for(var i=[],s=0;s<this.ColCfg;++s){var l=n*this.ColCfg+s;i.push(a[l])}r.push(i)}for(var o=0;o<a.length;++o){var h=a[o],u=h.row,c=h.col,C=u,g=c-1;if(!this.IsValidRowCol(C,g)||null==r[C][g]||r[C][g].num!=h.num){var f=u,T=c+1;if(!this.IsValidRowCol(f,T)||null==r[f][T]||r[f][T].num!=h.num){var b=u-1,p=c;if(!this.IsValidRowCol(b,p)||null==r[b][p]||r[b][p].num!=h.num){var m=u+1,v=c;this.IsValidRowCol(m,v)&&null!=r[m][v]&&r[m][v].num==h.num||t.push(h)}}}}return t},l.GetAllInitCanMergeCubes=function(e){for(var t=this.GetAllCubes(e),a=[],r=this.GetAllInitCanNotMergeCubes(e),n=0;n<t.length;++n){for(var i=!1,s=t[n],l=s.GetRowCol(),o=0;o<r.length;++o){var h=r[o].GetRowCol();if(l.equals(h)){i=!0;break}}i||a.push(s)}return a},l.GetAllSameCubes=function(e,t){for(var a=[],r=0;r<t.length;++r)t[r]==e&&a.push(r);return a},l.IsValidRow=function(e){return e>=0&&e<this.RowCfg},l.IsValidCol=function(e){return e>=0&&e<this.ColCfg},l.IsValidRowCol=function(e,t){return this.IsValidRow(e)&&this.IsValidCol(t)},l.ShowTaskMask=function(e){this.TableCreatorMask.active=e,e&&this.UpdateTaskProgress()},l.UpdateTaskProgress=function(){var e="";if(this.CurrentTaskType==Ge.Generate)e="当前生成进度:"+Math.ceil(100*this.GenerateCompletedTasks/this.CreateTablesCount)+"%\n"+this.GenerateCompletedTasks.toString()+"/"+this.CreateTablesCount.toString();else if(this.CurrentTaskType==Ge.Cacl){var t=this.CalcTableDatas.length*this.CalcSingleTimes;e="当前计算进度:"+Math.ceil(100*this.CalcCompletedTask/t)+"%\n"+this.CalcCompletedTask.toString()+"/"+t.toString()}this.LabelTableCreatorProgress.string=e},l.FinishAllCalcWorks=function(){D.Instance.terminateAll(),this.CurrentTaskType=Ge.NONE,this.CurrentTaskState=xe.STOPED},l.PrepareCalcDatas=function(){this.CalcTableDatas=[];for(var e=0;e<this.GenerateTableResults.length;++e){var t=new we;t.nums=k.clone(this.GenerateTableResults[e]),t.extData=k.clone(this.GenerateTableExtData[e]);for(var a=0;a<this.GenerateTableExtData[e].length;++a){var r=this.GenerateTableExtData[e][a];if(r==N.BOARDLEFT){var n=Math.floor(a/this.ColCfg),i=a-n*this.ColCfg,s=new Se(new g(n,i-1),new g(n,i));t.boardData.push(s)}else if(r==N.BOARDTOP){var l=Math.floor(a/this.ColCfg),o=a-l*this.ColCfg,h=new Se(new g(l-1,o),new g(l,o));t.boardData.push(h)}}this.CalcTableDatas.push(t)}},l.ClearCalcTempDatas=function(){this.CalcTableDatas=[],this.CalcCompletedTask=0},l.StartCalcTables=function(){var e=i(s().mark((function e(){var t,a,r,n,i,l,o,h,u,c,C=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ClearCalcTempDatas(),this.PrepareCalcDatas(),0!==this.CalcTableDatas.length){e.next=5;break}return this.ShowToast("对不起，未找到待计算数据！"),e.abrupt("return");case 5:this.FinishAllCalcWorks(),this.ClearTasks(),this.CurrentTaskType=Ge.Cacl,this.CurrentTaskState=xe.STARTED,this.ShowTaskMask(!0),t=Date.now(),x.log("开始大规模计算:"+t.toString()),a=Math.ceil(this.CalcTableDatas.length/this.CalcBatchSize),r=navigator.hardwareConcurrency||4,n=r<a?r:a,D.Instance.initWorkerPool(n),i=new Set,l=0;case 18:if(!(l<this.CalcSingleTimes)){e.next=34;break}o=s().mark((function e(){var t,a,r,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C.CurrentTaskState!==xe.STOPED){e.next=4;break}return C.CalcTableDatas=[],C.ShowToast("计算任务已终止！"),e.abrupt("return",{v:void 0});case 4:if(t=u*C.CalcBatchSize,a=Math.min(t+C.CalcBatchSize-1,C.CalcTableDatas.length-1),r=C.CalcTableDatas.slice(t,a+1),(o=C.ExecCalcBatch(t,a,l,r)).finally((function(){i.delete(o)})),i.add(o),!(i.size>=n)){e.next=13;break}return e.next=13,Promise.race(i);case 13:case"end":return e.stop()}}),e)})),u=0;case 21:if(!(u<a)){e.next=29;break}return e.delegateYield(o(),"t0",23);case 23:if(!(h=e.t0)){e.next=26;break}return e.abrupt("return",h.v);case 26:u++,e.next=21;break;case 29:return e.next=31,Promise.all(i);case 31:++l,e.next=18;break;case 34:c=Date.now(),x.log("所有计算任务完成！:"+c.toString()+",  总耗时："+(c-t).toString()+"毫秒"),this.ShowTaskMask(!1),this.ClearTasks(),this.ProgressCalcTableResults(),this.ShowToast("所有阵型计算完毕！",.3);case 40:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.ExecCalcBatch=function(){var e=i(s().mark((function e(t,a,r,n){var i,l,o,h,u,c,C,g,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="task-"+t+"-"+a,e.prev=1,l={rowCfg:this.RowCfg,colCfg:this.ColCfg,calcIndex:r},o=JSON.stringify(n),h={start:t,end:a,encodeData:o},e.next=7,D.Instance.execTask(i,h,l);case 7:if(u=e.sent,c=a-t+1,(C=JSON.parse(u)).length===c)for(g=t;g<=a;++g)f=C[g-t],this.CalcTableDatas[g]=f;this.CalcCompletedTask+=a-t+1,this.UpdateTaskProgress(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),x.error("任务 "+i+" 失败: "+e.t0);case 18:return e.abrupt("return",Promise.resolve());case 19:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(t,a,r,n){return e.apply(this,arguments)}}(),l.ProgressCalcTableResults=function(){for(var e=this.RowCfg*this.ColCfg/2,t=0;t<this.CalcTableDatas.length;++t){for(var a=this.CalcTableDatas[t],r=new Array,n=0;n<e;++n)r.push(0);if(a.winTimes<=0){a.canMergeCubeNumsAvg=new Array;for(var i=0;i<e;++i)a.canMergeCubeNumsAvg.push(0);this.CalcTableDatas[t]=a}else{for(var s=0;s<r.length;++s)for(var l=0;l<this.CalcSingleTimes;++l)r[s]+=a.canMergeCubeNums[l][s];null==a.canMergeCubeNumsAvg&&(a.canMergeCubeNumsAvg=new Array);for(var o=0;o<r.length;++o){var h=r[o]/this.CalcSingleTimes;a.canMergeCubeNumsAvg.push(h)}this.CalcTableDatas[t]=a}}for(var u=0;u<this.CalcTableDatas.length;++u){var c=this.CalcTableDatas[u];c.winTimesAvg=100*c.winTimes/this.CalcSingleTimes,this.CalcSingleTimes>c.winTimes?c.leftCubesAvg=.5*c.leftCubes/(this.CalcSingleTimes-c.winTimes):c.leftCubesAvg=0,c.initMergeNumberAvg=c.initMergeNum/this.CalcSingleTimes,c.multipleTimesAvg=c.multipleTimes/this.CalcSingleTimes,c.firstCanMergeDebuffAvg=c.firstCanMergeDebuff/this.CalcSingleTimes,c.tapMergeTimesAvg=0,c.moveMergeTimesAvg=0,c.leftOnePairTimesAvg=0,c.winTimes>0&&(c.tapMergeTimesAvg=c.tapMergeTimes/c.winTimes,c.moveMergeTimesAvg=c.moveMergeTimes/c.winTimes,c.leftOnePairTimesAvg=c.leftOnePairTimes/c.winTimes),this.CalcTableDatas[u]=c}},l.UpdateTableListView=function(){var e=this,t=this.GenerateTableResults.length,a=this.TableListView.getComponent(E);a.numberOfItems=t,a.cellForItemAt=function(t,a){var r=a.dequeueReusableCell("listcell");r.tag=t.item,r.getComponent(w).clickEvents=[];var n=new S;return n.target=e.node,n.component="TableCreator",n.handler="OnBtnTableCellClicked",r.getComponent(w).clickEvents.push(n),r.getChildByName("id").getComponent(c).string=t.item.toString()+".",r.getChildByName("data").getComponent(c).string=e.GenerateTableResults[t.item].toString(),r};var r=new M;r.spacing=10,r.rowHeight=60,a.layout=r,a.reloadData()},l.OnBtnTableCellClicked=function(e,t){var a,r=e.target;x.log(null==(a=r.tag)?void 0:a.toString());var n=r.tag;if(this.CurrentSelectTableIndex=-1,n<this.GenerateTableResults.length){var i=k.clone(this.GenerateTableResults[n]),s=k.clone(this.GenerateTableExtData[n]);this.GameMapLayer.Editor_InitMap(this.RowCfg,this.ColCfg,i,s),this.CurrentSelectTableIndex=n}},l.InitCardsSelectLayer=function(){this.LayoutCardList.destroyAllChildren(),this.AllButtonCardSelect=[];for(var e=1;e<=P.MAX_MAHJONG_NUM;++e){var t=f(this.PrefabButtonCardSelect);O.SetLocalSpriteFrame(t,P.GetNumberResPath(e)),t.parent=this.LayoutCardList,t.getComponent(w).clickEvents=[];var a=new S;a.target=this.node,a.component="TableCreator",a.handler="onBtnSelectCardClicked",a.customEventData=e.toString(),t.getComponent(w).clickEvents.push(a),this.AllButtonCardSelect.push(t)}},l.onBtnSelectCardClicked=function(e,t){this.ClearAllSelectCards();var a=e.target;a.getChildByName("SpLight").active=!0,this.CurrentSelectCard=a,this.GameMapLayer.SelectCardNum=parseInt(t)},l.ClearAllSelectCards=function(){for(var e=0;e<this.AllButtonCardSelect.length;++e){this.AllButtonCardSelect[e].getChildByName("SpLight").active=!1}this.CurrentSelectCard=null},l.OnBtnTableSaveClicked=function(){if(this.CurrentSelectTableIndex>=0&&this.CurrentSelectTableIndex<this.GenerateTableResults.length){var e=this.GameMapLayer.getAllCubes();if(e.length!==this.RowCfg*this.ColCfg)return void this.ShowToast("棋盘不完整，无法保存！");for(var t=this.GenerateTableResults[this.CurrentSelectTableIndex],a=[],r=0;r<this.RowCfg;++r)for(var n=0;n<this.ColCfg;++n){var i=r*this.ColCfg+n;if(i>=t.length)return void this.ShowToast("棋盘数据错误，保存失败！");var s=e[i];a.push(s.getNumber())}this.GenerateTableResults[this.CurrentSelectTableIndex]=a,this.CalcTableDatas.length>this.CurrentSelectTableIndex&&(this.CalcTableDatas[this.CurrentSelectTableIndex].nums=k.clone(a)),this.UpdateTableListView(),this.ShowToast("保存阵型成功！")}else this.ShowToast("当前选择阵型错误，无法保存！")},l.OnBtnTableResetClicked=function(){if(this.CurrentSelectTableIndex<0)this.ShowToast("当前未选择阵型！");else if(this.CurrentSelectTableIndex>=this.GenerateTableResults.length||this.CurrentSelectTableIndex>=this.GenerateTableExtData.length)this.ShowToast("数据出错！");else{var e=this.GenerateTableResults[this.CurrentSelectTableIndex],t=this.GenerateTableExtData[this.CurrentSelectTableIndex];this.GameMapLayer.Editor_InitMap(this.RowCfg,this.ColCfg,e,t)}},l.OnMahjongTypeSelectChanged=function(e,t){var a;null!=e&&(null!=(a=e.getComponent(y))&&a.isChecked&&(this.CurrentMahjongSpecialType=parseInt(t)+ye.NONE,x.log("选择麻将类型:"+this.CurrentMahjongSpecialType.toString())))},t}(G)).prototype,"ToastContent",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=t(te.prototype,"ToastItem",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne=t(te.prototype,"InputRow",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=t(te.prototype,"InputCol",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),se=t(te.prototype,"InputNumberTypeCount",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le=t(te.prototype,"InputSingleNumberCount",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=t(te.prototype,"InputInitRowCount",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=t(te.prototype,"InputInitColCount",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ue=t(te.prototype,"InputCreateTablesCount",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ce=t(te.prototype,"TableCreatorMask",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ce=t(te.prototype,"LabelTableCreatorProgress",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ge=t(te.prototype,"InputCalcTotalCount",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe=t(te.prototype,"TableListView",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=t(te.prototype,"GameMapLayer",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=t(te.prototype,"InputCubeTypeGenCount",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=t(te.prototype,"PrefabButtonCardSelect",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=t(te.prototype,"LayoutCardList",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee=te))||ee));l._RF.pop()}}}));

System.register("chunks:///_virtual/TableGenerateWokerManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Log.ts","./TableGenerateWorker.ts"],(function(e){var r,a,t,o,n,s;return{setters:[function(e){r=e.createForOfIteratorHelperLoose,a=e.createClass},function(e){t=e.cclegacy,o=e._decorator},function(e){n=e.default},function(e){s=e.default}],execute:function(){var i,c;t._RF.push({},"a57c6LopEdANLh7GTRP/zuX","TableGenerateWokerManager",void 0);var l=o.ccclass;o.property,e("TableGenerateWokerManager",l("TableGenerateWokerManager")(((c=function(){function e(){this.workerPool=[],this.busyWorkers=new Set}var t=e.prototype;return t.initWorkerPool=function(e){var r=Math.min(navigator.hardwareConcurrency||4,e);n.log("[TableGenerateWokerManager] 正在创建 "+r+" 个 Web Workers");for(var a=0;a<r;a++){var t=new Worker(s);this.workerPool.push(t)}},t.execTask=function(e,r,a){var t=this;return new Promise((function(o,s){var i=t.getAvailableWorker();i?(i.onmessage=function(r){var a=r.data,c=a.type,l=a.taskId,u=a.success;if(e===l)switch(n.log("worker.onmessage,  takskid: "+e.toString()),c){case"RESULT":t.releaseWorker(i),u?o(r.data.data):s(r.data.error);break;case"ERROR":t.releaseWorker(i),s(r.data.error)}},i.postMessage({type:"CALCULATE",taskId:e,data:r,args:a})):s("没有可用的 Worker")}))},t.getAvailableWorker=function(){for(var e,a=r(this.workerPool);!(e=a()).done;){var t=e.value;if(!this.busyWorkers.has(t))return this.busyWorkers.add(t),t}return null},t.releaseWorker=function(e){this.busyWorkers.delete(e)},t.terminateAll=function(){n.log("[TableGenerateWokerManager] 正在终止所有 Web Workers"),this.workerPool.forEach((function(e){try{e.postMessage({type:"TERMINATE"})}catch(e){n.error("终止 Worker 时出错: "+e)}})),this.workerPool=[],this.busyWorkers.clear()},a(e,null,[{key:"Instance",get:function(){return e.instance||(e.instance=new e),e.instance}}]),e}()).instance=null,i=c))||i);t._RF.pop()}}}));

System.register("chunks:///_virtual/TableGenerateWorker.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"83d46ywLqNKF4iy2QivvTAm","TableGenerateWorker",void 0);var r=function(){function t(t){console.error(t)}function e(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}var r=function(){function t(t,e){this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t}();function n(n){for(var a=n.rowCfg,o=n.colCfg,s=n.maxCubeNum,i=n.singleNumCount,f=n.initRowCount,u=n.initColCount,l=new Map,c=1;c<=s;++c)l.set(c,i);for(var h=[],g=0;g<a;++g){for(var v=[],p=0;p<o;++p)v.push(0);h.push(v)}for(var y=f;y>0&&l.size>0;){var d=Array.from(l.keys()),m=d[e(0,d.length)],k=l.get(m),x=m,M=k-2;l.set(m,M),M<=0&&l.delete(m);for(var R=!1,b=0,C=function(){b++;for(var t=e(0,a),r=h[t],n=[],o=0;o<r.length;o++)0===r[o]&&n.push(o);if(n.length<2)return 1;var s=n[e(0,n.length)];h[t][s]=x;var i,f=n.filter((function(t){return 1===Math.abs(t-s)}));if(f.length>0)i=f[e(0,f.length)];else{var u=n.filter((function(t){return t!==s}));i=u[e(0,u.length)]}h[t][i]=x,R=!0};!R&&b<100;)C();R&&y--}for(y=u;y>0&&l.size>0;){var w=Array.from(l.keys()),A=w[e(0,w.length)],T=l.get(A),L=A,S=T-2;l.set(A,S),S<=0&&l.delete(A);for(var E=!1,I=0,N=function(){I++;for(var t=e(0,o),r=[],n=0;n<a;n++)0===h[n][t]&&r.push(n);if(r.length<2)return 1;var s=r[e(0,r.length)];h[s][t]=L;var i,f=r.filter((function(t){return 1===Math.abs(t-s)}));if(f.length>0)i=f[e(0,f.length)];else{var u=r.filter((function(t){return t!==s}));i=u[e(0,u.length)]}h[i][t]=L,E=!0};!E&&I<100;)N();E&&y--}for(var O=[],U=0;U<a;U++)for(var z=0;z<o;z++)0===h[U][z]&&O.push(new r(U,z));for(var F=function(){var t=Array.from(l.keys()),r=t[e(0,t.length)],n=r,a=l.get(r)-2;l.set(r,a),a<=0&&l.delete(r);var o=e(0,O.length),s=O[o],i=O.filter((function(t,e){return e!==o}));if(0===i.length)return 1;var f=e(0,i.length),u=i[f];h[s.x][s.y]=n,h[u.x][u.y]=n,O=i.filter((function(t,e){return e!==f}))};l.size>0&&O.length>=2&&!F(););for(var _=[],j=0;j<a;j++)for(var q=0;q<o;q++)_.push(h[j][q]);for(var G=function(e){var r=_.filter((function(t){return t===_[e]}));r.length!=i&&(t("生成阵型数据校验失败： "+_.toString()),t("生成阵型数据校验失败 i = "+e.toString()+",nums = "+r.toString()))},W=0;W<_.length;++W)G(W);return _}self.onmessage=function(t){var e=t.data,r=e.type,a=e.taskId,o=e.data,s=e.args;try{switch(r){case"CALCULATE":for(var i=[],f=o.start;f<=o.end;f++)i.push(n(s));self.postMessage({type:"RESULT",taskId:a,success:!0,data:i});break;case"TERMINATE":self.close()}}catch(t){self.postMessage({type:"ERROR",taskId:a,success:!1,error:t})}}}.toString(),n=r.substring(r.indexOf("{")+1,r.lastIndexOf("}")),a=new Blob([n],{type:"application/javascript"});t("default",URL.createObjectURL(a));e._RF.pop()}}}));

System.register("chunks:///_virtual/UI_GameMap.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MahjongItem.ts","./CommonUtils.ts","./GameModel.ts","./GameMacros.ts","./Log.ts"],(function(t){var e,a,i,n,o,r,s,l,p,m,u,f,h,M,g,c,d,C,v,y,S,D,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,s=t.Prefab,l=t.Node,p=t.Size,m=t.Vec2,u=t.Vec3,f=t.UITransform,h=t.instantiate,M=t.Widget,g=t.Component,c=t.tween},function(t){d=t.MahjongItem},function(t){C=t.CommonUtils},function(t){v=t.default},function(t){y=t.CardPlayType,S=t.GameMacros,D=t.GameDiffMode},function(t){b=t.default}],execute:function(){var P,G,w,_,A,R,I;o._RF.push({},"7ef69Vw2N9CoqOTZYiR+jEW","UI_GameMap",void 0);var E=r.ccclass,B=r.property;t("UI_GameMap",(P=E("UI_GameMap"),G=B({type:s}),w=B({type:l}),P((R=e((A=function(t){function e(){for(var e,a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,i(e,"mPrefabMahjongItem",R,n(e)),i(e,"mGameMapBg",I,n(e)),e.mMapRowCfg=0,e.mMapColCfg=0,e.mMapData=[],e.mFirstSelectCube=null,e.mSecondSelectCube=null,e.mMapSize=p.ZERO,e.SelectCardType=y.Normal,e.SelectCardNum=0,e}a(e,t);var o=e.prototype;return o.onLoad=function(){v.initGameModel(),this.initMapData(),this.initMapSize(),this.node.setScale(.6,.6,.6),this.node.on(l.EventType.MOUSE_DOWN,this.OnMouseDown,this)},o.start=function(){},o.update=function(t){},o.OnMouseDown=function(t){var e=t.getButton();b.log("button: "+e.toString());var a=new m;t.getUILocation(a);var i=new u(a.x,a.y);i=this.mGameMapBg.getComponent(f).convertToNodeSpaceAR(i),b.log("Button Pos = "+a.toString()),b.log("Button localPos = "+i.toString());var n=this.GetRowColByPos(i);if(v.isValidRowCol(n.x,n.y))if(0===e){if(this.SelectCardNum<=0)return;this.mMapData[n.x][n.y]&&(this.mMapData[n.x][n.y].node.destroy(),this.mMapData[n.x][n.y]=null),this.addCube(n.x,n.y,this.SelectCardNum)}else 2===e&&this.mMapData[n.x][n.y]&&(this.mMapData[n.x][n.y].node.destroy(),this.mMapData[n.x][n.y]=null)},o.initMap=function(){this.clearAllCubes();for(var t=v.getRowCfg(),e=v.getColCfg(),a=v.getMapInitTable(),i=0;i<t;++i)for(var n=0;n<e;++n){var o=i*e+n;if(o>=a.length){i=t;break}this.addCube(i,n,a[o])}},o.addCube=function(t,e,a,i){var n,o;if(void 0===i&&(i=y.Normal),!v.isValidRowCol(t,e))return null;var r=h(this.mPrefabMahjongItem);r.parent=this.mGameMapBg,r.position=this.getGridPos(t,e),null==(n=r.getComponent(d))||n.setNumber(a),null==(o=r.getComponent(d))||o.setCardType(i),r.setSiblingIndex(t*this.mMapColCfg+e);var s=r.getComponent(d);return this.mMapData[t][e]=s,s},o.initMapData=function(){this.mMapRowCfg=v.getRowCfg(),this.mMapColCfg=v.getColCfg(),this.initMapArray()},o.initMapArray=function(){this.mMapData=[];for(var t=0;t<this.mMapRowCfg;++t){this.mMapData[t]=[];for(var e=0;e<this.mMapColCfg;++e)this.mMapData[t][e]=null}},o.getAllCubes=function(){for(var t=[],e=0;e<this.mMapData.length;++e)for(var a=0;a<this.mMapData[e].length;++a)this.mMapData[e][a]&&t.push(this.mMapData[e][a]);return t},o.clearAllCubes=function(){for(var t=this,e=0;e<this.mMapData.length;++e)if(null!=this.mMapData[e]&&null!=this.mMapData[e])for(var a=function(){var a=t.mMapData[e][i];if(C.isNull(a))return 1;a.node.active=!1,c(a.node).delay(10).call((function(){a.node.destroy()})).start(),t.mMapData[e][i]=null},i=0;i<this.mMapData[e].length;++i)a();this.mFirstSelectCube=null,this.mSecondSelectCube=null},o.initMapSize=function(){var t=v.getGameMapSize();this.node.getComponent(f).contentSize=t},o.getGridPos=function(t,e){var a=v.getGameMapSize(),i=new u(0,0);return i.x=-a.width/2+(e+.5)*S.MAP_CUBE_SIZE.width+e*S.MAP_POS_SPACE_X+S.MAP_POS_PRE_X,i.y=a.height/2-(t+.5)*S.MAP_CUBE_SIZE.height-t*S.MAP_POS_SPACE_Y-S.MAP_POS_PRE_Y,i},o.getGridWorlPos=function(t,e){var a=this.getGridPos(t,e);return a=this.mGameMapBg.getComponent(f).convertToWorldSpaceAR(a)},o.GetRowColByPos=function(t){for(var e=new m(-1,-1),a=S.MAP_CUBE_SIZE,i=0;i<this.mMapRowCfg;++i)for(var n=0;n<this.mMapColCfg;++n){var o=this.getGridPos(i,n);if(Math.abs(t.x-o.x)<a.width/2&&Math.abs(t.y-o.y)<a.height/2){e=new m(i,n),i=this.mMapRowCfg;break}}return e},o.Editor_InitMap=function(t,e,a,i){var n,o;if(a.length==i.length){if(this.clearAllCubes(),8===t&&6===e)v.setGameDiffMode(D.Easy),this.node.setScale(.6,.6,.6);else if(10===t&&8===e)v.setGameDiffMode(D.Hard),this.node.setScale(.5,.5,.5);else if(12===t&&10===e)v.setGameDiffMode(D.Expert),this.node.setScale(.4,.4,.4);else{if(12!==t||9!==e)return;v.setGameDiffMode(D.Triky),this.node.setScale(.4,.4,.4)}var r=v.getRowCfg(),s=v.getColCfg();this.mMapRowCfg=r,this.mMapColCfg=s,this.initMapArray(),this.initMapSize(),this.node.updateWorldTransform(),this.mGameMapBg.updateWorldTransform(),null==(n=this.node.getComponent(M))||n.updateAlignment(),null==(o=this.mGameMapBg.getComponent(M))||o.updateAlignment();for(var l=0;l<r;++l)for(var p=0;p<s;++p){var m=l*s+p;if(m>=a.length){l=r;break}this.addCube(l,p,a[m],i[m])}}},e}(g)).prototype,"mPrefabMahjongItem",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=e(A.prototype,"mGameMapBg",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=A))||_));o._RF.pop()}}}));

System.register("chunks:///_virtual/UIHelp.ts",["cc","./Log.ts"],(function(e){var t,o,r,i,n,a,s,l,c,p,f,d,u,g,m,S,v;return{setters:[function(e){t=e.cclegacy,o=e._decorator,r=e.Label,i=e.ProgressBar,n=e.tween,a=e.resources,s=e.Sprite,l=e.assetManager,c=e.SpriteFrame,p=e.Texture2D,f=e.Button,d=e.UIOpacity,u=e.Color,g=e.sp,m=e.math,S=e.UITransform},function(e){v=e.default}],execute:function(){var C,y;t._RF.push({},"8bc903ND7NCw5bKIpLjqh8x","UIHelp",void 0);var V=o.ccclass;o.property,e("DialogType",function(e){return e[e.EDialog_Yes=0]="EDialog_Yes",e[e.EDialog_YesClose=1]="EDialog_YesClose",e}({})),e("default",V("UIHelp")(((y=function(){function e(){}return e.SetLabel=function(e,t){if(e&&e.isValid){"number"==typeof t&&(t=t.toString());var o=e.getComponent(r);o&&(o.string=t)}},e.SetProgress=function(e,t,o,r,a){if(void 0===o&&(o=!1),void 0===a&&(a=.3),e&&e.isValid){var s=e.getComponent(i),l=Math.min(t,1);o?(s.progress>l&&(s.progress=0),n(s).to(a,{progress:l}).call((function(){r&&r()})).start()):(s.progress=l,r&&r())}},e.SetLocalSpriteFrame=function(e,t,o){e&&e.isValid&&(e.tag=t,a.load(t,(function(r,i){if(e&&e.isValid&&e.tag==t){if(r)return void v.error("UIHelp SetSpriteFrame: load error: "+r);var n=e.getComponent(s);n||(n=e.addComponent(s)),n.spriteFrame=i,o&&o(i)}})))},e.SetSpriteFrameFromAtlas=function(e,t){if(e&&e.isValid){var o=e.getComponent(s);o&&o.spriteAtlas&&(o.spriteFrame=o.spriteAtlas.getSpriteFrame(t))}},e.SetSpriteFrameToAtlas=function(e,t,o){if(e&&e.isValid&&t){var r=e.getComponent(s);r||(r=e.addComponent(s)),r.spriteFrame=t.getSpriteFrame(o)}},e.SetRemoteSpriteFrame=function(e,t,o){e&&e.isValid&&(e.tag=t,l.loadRemote(t,{ext:".png"},(function(r,i){if(e&&e.isValid&&e.tag==t){if(r)return void v.error("UIHelp SetRemoteSpriteFrame: load error: "+r);var n=e.getComponent(s);n||(n=e.addComponent(s));var a=new c,l=new p;l.image=i,a.texture=l,n.spriteFrame=a,o&&o()}})))},e.SetBtnGrayState=function(e,t){if(e&&e.isValid){var o=e.getComponent(f);if(o){o.interactable=!t;var r=e.getComponent(s);r&&(r.grayscale=t)}}},e.IsBtnGray=function(e){if(e&&e.isValid){var t=e.getComponent(f);return!!t&&!t.interactable}},e.SetSpriteGray=function(t,o,r){if(void 0===r&&(r=!0),t&&t.isValid){var i=t.getComponent(s);i&&(i.grayscale=o),r&&t.children.forEach((function(t){e.SetSpriteGray(t,o,r)}))}},e.SetOpacity=function(e,t){if(e&&e.isValid){var o=e.getComponent(d);o||(o=e.addComponent(d)),o.opacity=t}},e.SetSpriteOpacity=function(t,o,r){if(void 0===r&&(r=!1),t&&t.isValid){var i=t.getComponent(s);i&&(i.color=new u(i.color.r,i.color.g,i.color.b,o)),r&&t.children.forEach((function(t){e.SetSpriteOpacity(t,o,r)}))}},e.SetSkeletonOpacity=function(e,t){if(e&&e.isValid){var o=e.getComponent(g.Skeleton);o&&(o.color=new u(o.color.r,o.color.g,o.color.b,t))}},e.SetContentSize=function(e,t,o){this.setContentSize(e,new m.Size(t,o))},e.setContentSize=function(e,t){if(e&&e.isValid){var o=e.addComponent(S);o&&o.setContentSize(t)}},e.SetParent=function(e,t){if(e&&e.isValid&&t&&e.isValid){var o=e.getWorldPosition();e.parent=t,e.setPosition(t.getComponent(S).convertToNodeSpaceAR(o))}},e}())._res_bundle=null,C=y))||C);t._RF.pop()}}}));

System.register("chunks:///_virtual/Utils.ts",["cc"],(function(t){var e,n,r,o;return{setters:[function(t){e=t.cclegacy,n=t.randomRangeInt,r=t.sys,o=t.Vec3}],execute:function(){e._RF.push({},"73706PgsvhF17IXpnIvVMze","Utils",void 0);t("default",function(){function t(){}return t.GetTime=function(){return this.GetLocalTime()},t.GetLocalTime=function(){return(new Date).getTime()},t.GetLocalSecondsTime=function(){return Math.floor(t.GetLocalTime()/1e3)},t.IsSameDay=function(t,e){var n=new Date(t),r=new Date(e);return n.getDate()==r.getDate()&&n.getMonth()==r.getMonth()&&n.getFullYear()==r.getFullYear()},t.GetMonthDay=function(t){var e=[31,28,31,30,31,30,31,31,30,31,30,31];return(t%4==0&&t%100!=0||t%400==0)&&(e[1]=29),e},t.GetWeekDay=function(t,e,n){var r=e,o=t;return 1!=e&&2!=e||(r+=12,o--),Math.floor((n+2*e+3*(r+1)/5+o+o/4-o/100+o/400)%7+1)},t.GetTimeFormat=function(t){var e=new Date(t);return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},t.GetMonthAllDay=function(t,e){return this.GetMonthDay(t)[e]},t.GetDays=function(t,e,n){for(var r=this.GetMonthDay(t),o=0,a=0;a<e-1;a++)o+=r[a];return o+=n},t.GetDayStamp=function(t){return Math.floor(t.getTime()/864e5)},t.AddDate=function(t,e){for(var n=new Date(t),r=n.getDate()+e,o=n.getMonth(),a=n.getFullYear(),u=this.GetMonthDay(a);r>u[o-1];)r-=u[o-1],++o>12&&(a++,u=this.GetMonthDay(a));return new Date(a,o,r).getTime()},t.GetTimeString=function(t,e){void 0===e&&(e=!1),t=Math.max(t,0);var n=Math.floor(t/3600),r=Math.floor(t%3600/60),o=Math.floor(t%60),a=""+n,u=""+r,i=""+o;return n<10&&(a="0"+a),r<10&&(u="0"+u),o<10&&(i="0"+i),e||n>0?a+":"+u+":"+i:u+":"+i},t.GetDateStr=function(t){if(t<=0)return"";var e=new Date(t);return e.getFullYear()+":"+(e.getMonth()+1)+":"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},t.localDateToUtcTime=function(t,e,n,r){var o=new Date(t);return o.setHours(e),o.setMinutes(n),o.setSeconds(r),o.getTime()},t.MonthStr=function(t){var e="";if(t>0&&t<13){e=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"][t-1]}return e},t.SplitInt=function(t,e){void 0===e&&(e=",");var n=[];""!=t&&t.split(e).forEach((function(t){n.push(parseInt(t))}));return n},t.SplitStr=function(t,e){void 0===e&&(e=",");var n=[];return""!=t&&(n=t.split(e)),n},t.GetNum2Thousands=function(t,e){var n=t.toString();if(t>=Math.pow(10,9)){var r=t/Math.pow(10,9);n=e?Math.floor(r)+"B":r.toFixed(2)+"B"}else if(t>=Math.pow(10,6)){var o=t/Math.pow(10,6);n=e?Math.floor(o)+"M":o.toFixed(2)+"M"}else if(t>=Math.pow(10,4)){var a=t/Math.pow(10,3);n=e?Math.floor(a)+"K":a.toFixed(2)+"K"}return n},t.GetLinearValue=function(t,e,n,r,o,a){void 0===a&&(a=!0);var u=e+(r-e)*(o-t)/(n-t);return a&&(u=this.Clamp(u,e,r)),u},t.Clamp=function(t,e,n){var r=e<n?e:n,o=e>n?e:n;return t<r?r:t>o?o:t},t.ConvertVersionStringToNumber=function(t){var e,n=0;return 3!=(e=t.split(".")).length?0:(n+=1e4*Number(e[0]),n+=100*Number(e[1]),n+=Number(e[2]))},t.randIndex=function(t){for(var e=0,r=0;r<t.length;++r)e+=t[r];for(var o=n(1,e),a=0,u=0;u<t.length;++u)if(t[u]>0&&(a+=t[u])>=o)return u;return 0},t.shuffleArray=function(t,e){void 0===e&&(e=-1),-1==e&&(e=t.length);for(var n=e-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),o=[t[r],t[n]];t[n]=o[0],t[r]=o[1]}return t},t.GetToday=function(){var t=new Date;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()},t.IsBrowser=function(){return r.isBrowser},t.RandomUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},t.twoBezier=function(t,e,n,r){var a=Math.pow(1-t,2)*e.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,u=Math.pow(1-t,2)*e.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;return new o(a,u,0)},t.cubicBezier=function(t,e,n,r,a){var u=1-t,i=u*u,c=t*t,l=e.multiplyScalar(i*u),f=n.multiplyScalar(3*i*t),s=r.multiplyScalar(3*u*c),h=a.multiplyScalar(c*t);return new o(l.x+f.x+s.x+h.x,l.y+f.y+s.y+h.y,l.z+f.z+s.z+h.z)},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/WebHelper.js",["./cjs-loader.mjs"],(function(e,t){var r;return{setters:[function(e){r=e.default}],execute:function(){e("default",void 0);var u=e("__cjsMetaURL",t.meta.url);r.define(u,(function(t,r,u,n,s){e("default",u.exports)}),{})}}}));

System.register("chunks:///_virtual/WebHelper.mjs_cjs=&original=.js",["./WebHelper.js","./cjs-loader.mjs"],(function(e,r){var t,s;return{setters:[function(r){t=r.__cjsMetaURL;var s={};s.__cjsMetaURL=r.__cjsMetaURL,s.default=r.default,e(s)},function(e){s=e.default}],execute:function(){t||s.throwInvalidWrapper("./WebHelper.js",r.meta.url),s.require(t)}}}));

System.register("chunks:///_virtual/WorkerHelper.js",["./cjs-loader.mjs"],(function(e,t){var r;return{setters:[function(e){r=e.default}],execute:function(){e("default",void 0);var u=e("__cjsMetaURL",t.meta.url);r.define(u,(function(t,r,u,n,s){e("default",u.exports)}),{})}}}));

System.register("chunks:///_virtual/WorkerHelper.mjs_cjs=&original=.js",["./WorkerHelper.js","./cjs-loader.mjs"],(function(e,r){var t,s;return{setters:[function(r){t=r.__cjsMetaURL;var s={};s.__cjsMetaURL=r.__cjsMetaURL,s.default=r.default,e(s)},function(e){s=e.default}],execute:function(){t||s.throwInvalidWrapper("./WorkerHelper.js",r.meta.url),s.require(t)}}}));

System.register("chunks:///_virtual/WorkerHelper.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"91810PWOPxDK7SrziWgttuL","WorkerHelper",void 0);var r=function(){}.toString(),n=r.substring(r.indexOf("{")+1,r.lastIndexOf("}"));n=n;var c=new Blob([n],{type:"application/javascript"});e("default",URL.createObjectURL(c));t._RF.pop()}}}));

System.register("chunks:///_virtual/yx-collection-view.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,l,s,a,u,h,c,p,d,f,y,m,b,g,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.createClass,n=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){l=t.cclegacy,s=t._decorator,a=t.math,u=t.Enum,h=t.Prefab,c=t.NodeEventType,p=t.Node,d=t.UITransform,f=t.UIOpacity,y=t.ScrollView,m=t.Mask,b=t.Component,g=t.NodePool,v=t.instantiate}],execute:function(){var _,C,S,E,x,I,A,w,N,V,M,O,P,T,D,R,L,F,z,k,K,U,Y,B,q,H,X,G,Z,W,j,J,Q,$,tt,et,it,nt;l._RF.push({},"f94cbxum3xAsomhVNW1piY0","yx-collection-view",void 0);var ot=s.ccclass,rt=s.property,lt=s.executionOrder,st=s.disallowMultiple,at=s.help,ut=new a.Vec3,ht=new a.Rect,ct=new a.Rect,pt=function(t){return t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t}(pt||{});u(pt);var dt=function(t){return t[t.RECYCLE=0]="RECYCLE",t[t.PRELOAD=1]="PRELOAD",t}(dt||{});u(dt);var ft=(_=ot("_yx_editor_register_element_info"),C=rt({type:h,tooltip:"cell 节点预制体，必须配置"}),S=rt({tooltip:"节点重用标识符，必须配置"}),E=rt({tooltip:"节点挂载的自定义组件\n如果需要监听 NodePool 的重用/回收事件，确保你的自定义组件已经实现了 YXCollectionViewCell 接口并配置此属性为你的自定义组件名\n如果不需要，可以忽略此配置"}),_((A=e((I=function(){o(this,"prefab",A,this),o(this,"identifier",w,this),o(this,"comp",N,this)}).prototype,"prefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(I.prototype,"identifier",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),N=e(I.prototype,"comp",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),x=I))||x),yt=t("YXIndexPath",function(){function t(t,e){this._item=0,this._section=0,this._section=t,this._item=e}var e=t.prototype;return e.clone=function(){return new t(this.section,this.item)},e.equals=function(t){return this.section==t.section&&this.item==t.item},e.toString=function(){return this.section+" - "+this.item},i(t,[{key:"section",get:function(){return this._section}},{key:"item",get:function(){return this._item}},{key:"row",get:function(){return this.item}}]),t}());V=yt,yt.ZERO=new V(0,0);var mt=t("YXEdgeInsets",function(){function t(t,e,i,n){this.top=void 0,this.left=void 0,this.bottom=void 0,this.right=void 0,this.top=t,this.left=e,this.bottom=i,this.right=n}var e=t.prototype;return e.clone=function(){return new t(this.top,this.left,this.bottom,this.right)},e.equals=function(t){return this.top==t.top&&this.left==t.left&&this.bottom==t.bottom&&this.right==t.right},e.set=function(t){this.top=t.top,this.left=t.left,this.bottom=t.bottom,this.right=t.right},e.toString=function(){return"[ "+this.top+", "+this.left+", "+this.bottom+", "+this.right+" ]"},t}());M=mt,mt.ZERO=new M(0,0,0,0);var bt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).identifier=void 0,e.attributes=void 0,e}return n(e,t),e}(b),gt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._yx_scroll_offset_on_touch_start=null,e._yx_startAttenuatingAutoScrollTargetOffset=null,e}n(e,t);var i=e.prototype;return i._onMouseWheel=function(e,i){var n=this.node.getComponent(Ct);null!=n&&0!=n.scrollEnabled&&0!=n.wheelScrollEnabled&&t.prototype._onMouseWheel.call(this,e,i)},i._startAttenuatingAutoScroll=function(t,e){var i=t.clone();if(i.normalize(),this._content&&this.view){var n=this._content._uiProps.uiTransformComp.contentSize,o=this.view.contentSize,r=n.width-o.width,l=n.height-o.height,s=this._calculateAttenuatedFactor(r),a=this._calculateAttenuatedFactor(l);i.x=i.x*r*(1-this.brake)*s,i.y=i.y*l*a*(1-this.brake),i.z=0}var u=t.length(),h=i.length()/u;if(i.add(t),this.brake>0&&h>7){h=Math.sqrt(h);var c=t.clone();c.multiplyScalar(h),i.set(c),i.add(t)}var p=this._calculateAutoScrollTimeByInitialSpeed(e.length());if(this.brake>0&&h>3&&(p*=h=3),0===this.brake&&h>1&&(p*=h),this._yx_startAttenuatingAutoScrollTargetOffset){var d=this.getScrollOffset();d.x+=i.x,d.y+=i.y;var f=this._yx_startAttenuatingAutoScrollTargetOffset(e,this._yx_scroll_offset_on_touch_start,d,p);if(f){var y=f.offset,m=f.time||p,b=f.attenuated||!0;if(y)return void this.scrollToOffset(y,m,b)}}this._startAutoScroll(i,p,!0)},i._onTouchBegan=function(e,i){if(0!=this.node.getComponent(Ct).scrollEnabled){var n=this.getScrollOffset();n.x=-n.x,this._yx_scroll_offset_on_touch_start=n;var o=[e.target];i&&(o=o.concat(i));for(var r=0;r<o.length;r++){o[r]._yx_scroll_target=null}t.prototype._onTouchBegan.call(this,e,i)}},i._onTouchMoved=function(e,i){if(0!=this.node.getComponent(Ct).scrollEnabled){var n=this._yxGetScrollTarget(e,i);this.node===n&&t.prototype._onTouchMoved.call(this,e,i)}},i._hasNestedViewGroup=function(t,e){return!1},i._stopPropagationIfTargetIsMe=function(e){this._touchMoved?e.propagationStopped=!0:t.prototype._stopPropagationIfTargetIsMe.call(this,e)},i._yxGetScrollTarget=function(t,i){var n=t.target._yx_scroll_target;if(n)return n;var o=[t.target];if(i&&(o=o.concat(i)),1==o.length)return o[0];var r=t.touch,l=r.getLocation().subtract(r.getStartLocation()),s=Math.abs(l.x),a=Math.abs(l.y);if(Math.abs(s-a)<5)return null;for(var u=null,h=0;h<o.length;h++){var c=o[h],p=c.getComponent(e);if(p){var d=c.getComponent(Ct);if(d&&0==d.scrollEnabled)continue;if(null==u&&(u=c),p.horizontal&&p.vertical)continue;if(!p.horizontal&&!p.vertical)continue;if(p.horizontal&&s>a){u=c;break}if(p.vertical&&a>s){u=c;break}}}if(u)for(var f=0;f<o.length;f++){o[f]._yx_scroll_target=u}return u},e}(y),vt=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.getAtIdx=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var o=this._pool,r=0;r<o.length;r++){var l=o[r],s=l.getComponent(bt);if(s&&s.attributes.indexPath.equals(t)){o.splice(r,1);var a=this.poolHandlerComp?l.getComponent(this.poolHandlerComp):null;return a&&a.reuse&&a.reuse(arguments),l}}return null},e}(g),_t=(t("YXLayoutAttributes",function(){function t(){this._indexPath=null,this._elementCategory="Cell",this._supplementaryKinds="",this._frame=new a.Rect,this.zIndex=0,this.opacity=null,this.scale=null,this.offset=null,this.eulerAngles=null}return t.layoutAttributesForCell=function(e){var i=new t;return i._indexPath=e,i._elementCategory="Cell",i},t.layoutAttributesForSupplementary=function(e,i){var n=new t;return n._indexPath=e,n._elementCategory="Supplementary",n._supplementaryKinds=i,n},i(t,[{key:"indexPath",get:function(){return this._indexPath}},{key:"elementCategory",get:function(){return this._elementCategory}},{key:"supplementaryKinds",get:function(){return this._supplementaryKinds}},{key:"frame",get:function(){return this._frame}}]),t}()),t("YXLayout",function(){function t(){this.contentSize=a.Size.ZERO,this.attributes=[]}var e=t.prototype;return e.initOffset=function(t){},e.targetOffset=function(t,e,i,n,o){return null},e.onScrollEnded=function(t){},e.layoutAttributesForElementsInRect=function(t,e){return this.attributes},e.layoutAttributesForItemAtIndexPath=function(t,e){return this.attributes.find((function(e){return e.indexPath.equals(t)&&"Cell"===e.elementCategory}))},e.layoutAttributesForSupplementaryAtIndexPath=function(t,e,i){return this.attributes.find((function(e){return e.indexPath.equals(t)&&"Supplementary"===e.elementCategory&&e.supplementaryKinds===i}))},e.scrollTo=function(t,e){return null},e.shouldUpdateAttributesZIndex=function(){return!1},e.shouldUpdateAttributesOpacity=function(){return!1},e.shouldUpdateAttributesForBoundsChange=function(){return!1},e.onDestroy=function(){},t}())),Ct=t("YXCollectionView",(O=ot("YXCollectionView"),P=st(!0),T=lt(-1),D=at("https://github.com/568071718/creator-collection-view"),R=rt({tooltip:"自动给挂载节点添加 mask 组件",visible:!0}),L=rt({tooltip:"允许手势滚动"}),F=rt({tooltip:"允许鼠标滑轮滚动"}),z=rt({type:pt,tooltip:"列表滚动方向"}),k=rt({type:dt,tooltip:"列表单元节点加载模式 (详细区别查看枚举注释)\nRECYCLE: 根据列表显示范围加载需要的节点，同类型的节点会进行复用\nPRELOAD: 会实例化所有节点，并非真正的虚拟列表，仅仅是把显示范围外的节点透明了，如果列表数据量很大仍然会卡"}),K=rt({tooltip:"预加载模式下每帧加载多少个节点",visible:function(){return this.mode==dt.PRELOAD}}),U=rt({tooltip:"每多少帧刷新一次可见节点，1 表示每帧都刷"}),Y=rt({tooltip:"滚动过程中，每多少帧回收一次不可见节点，1表示每帧都回收，0表示不在滚动过程中回收不可见节点"}),B=rt({type:[ft],visible:!0,displayName:"Register Cells",tooltip:"配置此列表内需要用到的 cell 节点类型"}),q=rt({type:[ft],visible:!0,displayName:"Register Supplementarys",tooltip:"配置此列表内需要用到的 Supplementary 节点类型"}),O(H=P(H=T(H=D(((nt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n))||this,o(e,"mask",G,r(e)),o(e,"scrollEnabled",Z,r(e)),o(e,"wheelScrollEnabled",W,r(e)),o(e,"scrollDirection",j,r(e)),o(e,"mode",J,r(e)),o(e,"preloadNodesLimitPerFrame",Q,r(e)),e.preloadProgress=null,o(e,"frameInterval",$,r(e)),o(e,"recycleInterval",tt,r(e)),o(e,"registerCellForEditor",et,r(e)),o(e,"registerSupplementaryForEditor",it,r(e)),e.pools=new Map,e.makers=new Map,e.numberOfSections=1,e.numberOfItems=0,e.cellForItemAt=null,e.supplementaryForItemAt=null,e.onCellDisplay=null,e.onCellEndDisplay=null,e.onSupplementaryDisplay=null,e.onSupplementaryEndDisplay=null,e.onTouchCellAt=null,e.onTouchSupplementaryAt=null,e.layout=null,e.visibleNodesMap=new Map,e.preloadNodesMap=new Map,e.reloadDataCounter=0,e._frameIdx=0,e._late_update_visible_data=!1,e._late_recycle_invisible_node=!1,e._late_reload_data=!1,e.preloadIdx=null,e}n(e,t);var l=e.prototype;return l.registerCell=function(t,e,i){void 0===i&&(i=null);t="Cell"+t;var n=new vt(i);this.pools.set(t,n),this.makers.set(t,e)},l.registerSupplementary=function(t,e,i){void 0===i&&(i=null);t="Supplementary"+t;var n=new vt(i);this.pools.set(t,n),this.makers.set(t,e)},l.dequeueReusableCell=function(t,e){return void 0===e&&(e=null),this._dequeueReusableElement(t,"Cell",e)},l.dequeueReusableSupplementary=function(t,e){return void 0===e&&(e=null),this._dequeueReusableElement(t,"Supplementary",e)},l._dequeueReusableElement=function(t,e,i){void 0===i&&(i=null),t=e+t;var n=this.pools.get(t);if(null==n)throw new Error("YXCollectionView: dequeueReusable"+e+" 错误，未注册的 identifier");var o=null;(null==o&&i&&n instanceof vt&&(o=n.getAtIdx(i)),null==o&&(o=n.get()),null==o)&&(((o=this.makers.get(t)()).getComponent(bt)||o.addComponent(bt)).identifier=t,o.on(c.TOUCH_END,this.onTouchElement,this));return o},l.getNumberOfSections=function(){return this.numberOfSections instanceof Function?this.numberOfSections(this):this.numberOfSections},l.getNumberOfItems=function(t){return this.numberOfItems instanceof Function?this.numberOfItems(t,this):this.numberOfItems},l.onTouchElement=function(t){var e=t.target;if(e instanceof p!=0){var i=e.getComponent(bt);if(null!=i){var n=i.attributes;if(null!=n)return"Cell"===n.elementCategory?this.onTouchCellAt?void this.onTouchCellAt(n.indexPath,this):void 0:void("Supplementary"!==n.elementCategory||this.onTouchSupplementaryAt&&this.onTouchSupplementaryAt(n.indexPath,this,n.supplementaryKinds))}}},l._getLayoutAttributesCacheKey=function(t){return this._getVisibleCacheKey(t.indexPath,t.elementCategory,t.supplementaryKinds)},l._getVisibleCacheKey=function(t,e,i){return void 0===i&&(i=""),""+t+e+i},l.getVisibleRect=function(){var t=ht;return t.origin=this.scrollView.getScrollOffset(),t.x=-t.x,t.size=this.scrollView.view.contentSize,t},l.getVisibleCellNode=function(t){var e=this._getVisibleCacheKey(t,"Cell");return this.visibleNodesMap.get(e)},l.getVisibleSupplementaryNode=function(t,e){var i=this._getVisibleCacheKey(t,"Supplementary",e);return this.visibleNodesMap.get(i)},l.getVisibleCellNodes=function(){var t=[];return this.visibleNodesMap.forEach((function(e){"Cell"===e.getComponent(bt).attributes.elementCategory&&t.push(e)})),t},l.getVisibleSupplementaryNodes=function(t){void 0===t&&(t=null);var e=[];return this.visibleNodesMap.forEach((function(i){var n=i.getComponent(bt);"Supplementary"===n.attributes.elementCategory&&(null!==t&&n.attributes.supplementaryKinds!==t||e.push(i))})),e},l.getElementAttributes=function(t){var e=t.getComponent(bt);return e?e.attributes:null},l.reloadData=function(){this.node.activeInHierarchy&&this.node.parent?this._reloadData():this._late_reload_data=!0},l.update_reloadDataIfNeeds=function(t){0!=this._late_reload_data&&this._reloadData()},l._reloadData=function(){var t=this;if(this._late_reload_data=!1,null==this.layout)throw new Error("YXCollectionView: 参数错误，请正确配置 layout 以确定布局方案");this.scrollView.stopAutoScroll(),this.pools.forEach((function(t){t.clear()})),this.mode==dt.RECYCLE&&(this.visibleNodesMap.forEach((function(e,i){var n=e.getComponent(bt);t.pools.get(n.identifier).put(e),t.visibleNodesMap.delete(i),"Cell"===n.attributes.elementCategory&&t.onCellEndDisplay&&t.onCellEndDisplay(n.node,n.attributes.indexPath,t),"Supplementary"===n.attributes.elementCategory&&t.onSupplementaryEndDisplay&&t.onSupplementaryEndDisplay(n.node,n.attributes.indexPath,t,n.attributes.supplementaryKinds)})),this.visibleNodesMap.clear()),this.mode==dt.PRELOAD&&(this.visibleNodesMap.forEach((function(t,e){t&&(t.removeFromParent(),t.destroy())})),this.visibleNodesMap.clear(),this.preloadNodesMap.forEach((function(t,e){t&&(t.removeFromParent(),t.destroy())})),this.preloadNodesMap.clear(),this.preloadIdx=0);var e=this.scrollView.getScrollOffset();if(e.x=-e.x,this.layout.prepare(this),(this.scrollView.content.getComponent(d)||this.scrollView.content.addComponent(d)).contentSize=this.layout.contentSize,this.reloadDataCounter<=0)this.layout.initOffset(this);else{var i=this.scrollView.getMaxScrollOffset();a.Vec2.min(e,e,i),this.scrollView.scrollToOffset(e)}this.markForUpdateVisibleData(!0),this.reloadDataCounter++},l.reloadVisibleElements=function(t){void 0===t&&(t=null),this._late_update_visible_data=!1,null==t&&(t=this.getVisibleRect());var e=this.layout.layoutAttributesForElementsInRect(t,this),i=this.layout.shouldUpdateAttributesZIndex();i&&(null!=e&&e!=this.layout.attributes||(e=this.layout.attributes.slice()),e.sort((function(t,e){return t.zIndex-e.zIndex})));for(var n=this.layout.shouldUpdateAttributesForBoundsChange(),o=0;o<e.length;o++){var r=e[o];if(0!=t.intersects(r.frame)){var l=this._getLayoutAttributesCacheKey(r),s=null;if(null==s&&(s=this.preloadNodesMap.get(l)),null==s&&(s=this.visibleNodesMap.get(l)),null==s&&("Cell"===r.elementCategory&&(s=this.cellForItemAt(r.indexPath,this)),"Supplementary"===r.elementCategory&&(s=this.supplementaryForItemAt(r.indexPath,this,r.supplementaryKinds))),null==s){if("Cell"===r.elementCategory)throw new Error("需要实现 cellForItemAt 方法并确保正确的返回了节点");if("Supplementary"===r.elementCategory)throw new Error("需要实现 supplementaryForItemAt 方法并确保正确的返回了节点")}var a=this.restoreNodeIfNeeds(s);(1==a||n)&&this.applyLayoutAttributes(s,r),i&&s.setSiblingIndex(-1),this.visibleNodesMap.set(l,s),1==a&&("Cell"===r.elementCategory&&this.onCellDisplay&&this.onCellDisplay(s,r.indexPath,this),"Supplementary"===r.elementCategory&&this.onSupplementaryDisplay&&this.onSupplementaryDisplay(s,r.indexPath,this,r.supplementaryKinds))}}e=[]},l.restoreNodeIfNeeds=function(t){var e=0;t.parent!=this.scrollView.content&&(t.parent=this.scrollView.content,e=1);var i=t.getComponent(f);return this.mode==dt.PRELOAD&&null==i&&(i=t.addComponent(f)),i&&255!==i.opacity&&(i.opacity=255,e=1),e},l.recycleInvisibleNodes=function(t){var e=this;void 0===t&&(t=null),this._late_recycle_invisible_node=!1,null==t&&(t=this.getVisibleRect());var i=ct,n=this.scrollView.content.getComponent(d).contentSize;this.visibleNodesMap.forEach((function(o,r){var l=o.getComponent(bt),s=o.getComponent(d).getBoundingBox();i.size=s.size,i.x=.5*(n.width-i.width)+o.position.x,i.y=.5*(n.height-i.height)-o.position.y,0==t.intersects(i)&&(e.mode==dt.PRELOAD?(o.getComponent(f).opacity=0,e.preloadNodesMap.set(r,o)):e.pools.get(l.identifier).put(o),e.visibleNodesMap.delete(r),"Cell"===l.attributes.elementCategory&&e.onCellEndDisplay&&e.onCellEndDisplay(l.node,l.attributes.indexPath,e),"Supplementary"===l.attributes.elementCategory&&e.onSupplementaryEndDisplay&&e.onSupplementaryEndDisplay(l.node,l.attributes.indexPath,e,l.attributes.supplementaryKinds))}))},l.applyLayoutAttributes=function(t,e){(t.getComponent(bt).attributes=e,(t.getComponent(d)||t.addComponent(d)).setContentSize(e.frame.size),ut.x=.5*-(this.layout.contentSize.width-e.frame.width)+e.frame.x,ut.y=.5*+(this.layout.contentSize.height-e.frame.height)-e.frame.y,ut.z=t.position.z,e.offset&&a.Vec3.add(ut,ut,e.offset),t.position=ut,e.scale&&(t.scale=e.scale),e.eulerAngles&&(t.eulerAngles=e.eulerAngles),this.layout.shouldUpdateAttributesOpacity()&&e.opacity)&&((t.getComponent(f)||t.addComponent(f)).opacity=e.opacity)},l.markForUpdateVisibleData=function(t){if(void 0===t&&(t=!1),t){var e=this.getVisibleRect();return this.reloadVisibleElements(e),void this.recycleInvisibleNodes(e)}this._late_update_visible_data=!0,this._late_recycle_invisible_node=!0},l.scrollTo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);var n,o=this.layout.scrollTo(t,this);null==o&&(o=null==(n=this.layout.layoutAttributesForItemAtIndexPath(t,this))?void 0:n.frame.origin);o&&(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(o,e,i),this.markForUpdateVisibleData())},l.onLoad=function(){for(var t=this,e=function(){var e=t.registerCellForEditor[i];t.registerCell(e.identifier,(function(){return v(e.prefab)}),e.comp)},i=0;i<this.registerCellForEditor.length;i++)e();for(var n=function(){var e=t.registerSupplementaryForEditor[o];t.registerSupplementary(e.identifier,(function(){return v(e.prefab)}),e.comp)},o=0;o<this.registerSupplementaryForEditor.length;o++)n();this.node.on(y.EventType.SCROLL_BEGAN,this.onScrollBegan,this),this.node.on(y.EventType.SCROLLING,this.onScrolling,this),this.node.on(y.EventType.TOUCH_UP,this.onScrollTouchUp,this),this.node.on(y.EventType.SCROLL_ENDED,this.onScrollEnded,this),this._scrollView._yx_startAttenuatingAutoScrollTargetOffset=function(e,i,n,o){return t.layout.targetOffset(t,e,i,n,o)}},l.onDestroy=function(){this.node.off(y.EventType.SCROLL_BEGAN,this.onScrollBegan,this),this.node.off(y.EventType.SCROLLING,this.onScrolling,this),this.node.off(y.EventType.TOUCH_UP,this.onScrollTouchUp,this),this.node.off(y.EventType.SCROLL_ENDED,this.onScrollEnded,this),this._scrollView._yx_startAttenuatingAutoScrollTargetOffset=null,this.visibleNodesMap.forEach((function(t,e){t&&(t.removeFromParent(),t.destroy())})),this.visibleNodesMap.clear(),this.visibleNodesMap=null,this.preloadNodesMap.forEach((function(t,e){t&&(t.removeFromParent(),t.destroy())})),this.preloadNodesMap.clear(),this.preloadNodesMap=null,this.pools.forEach((function(t){t.clear()})),this.pools.clear(),this.pools=null,this.makers.clear(),this.makers=null,this.layout&&this.layout.onDestroy()},l.update=function(t){this._frameIdx++,this.update_reloadVisibleNodesIfNeeds(t),this.update_recycleInvisibleNodesIfNeeds(t),this.update_reloadDataIfNeeds(t),this.update_preloadNodeIfNeeds(t)},l.update_reloadVisibleNodesIfNeeds=function(t){0!=this._late_update_visible_data&&(this.frameInterval<=1||this._frameIdx%this.frameInterval==0)&&this.reloadVisibleElements()},l.update_recycleInvisibleNodesIfNeeds=function(t){0!=this._late_recycle_invisible_node&&this.recycleInterval>=1&&this._frameIdx%this.recycleInterval==0&&this.recycleInvisibleNodes()},l.update_preloadNodeIfNeeds=function(t){if(this.mode===dt.PRELOAD&&null!=this.preloadIdx&&!(this.preloadIdx>=this.layout.attributes.length||this.preloadNodesLimitPerFrame<=0))for(var e=0,i=!1;!i&&e<this.preloadNodesLimitPerFrame;){var n=this.layout.attributes[this.preloadIdx],o=this._getLayoutAttributesCacheKey(n),r=null;null==r&&(r=this.visibleNodesMap.get(o)),null==r&&(r=this.preloadNodesMap.get(o)),null==r&&("Cell"===n.elementCategory&&(r=this.cellForItemAt(n.indexPath,this)),"Supplementary"===n.elementCategory&&(r=this.supplementaryForItemAt(n.indexPath,this,n.supplementaryKinds)),this.restoreNodeIfNeeds(r),this.applyLayoutAttributes(r,n),this.visibleNodesMap.set(o,r),this._late_recycle_invisible_node=!0),this.preloadNodesMap.set(o,r),this.preloadIdx++,e++,this.preloadProgress&&this.preloadProgress(this.preloadIdx,this.layout.attributes.length),i=this.preloadIdx>=this.layout.attributes.length}},l.onScrollBegan=function(){},l.onScrolling=function(){this.layout.shouldUpdateAttributesForBoundsChange()?this.reloadVisibleElements():this._late_update_visible_data=!0,this.recycleInterval>0&&(this._late_recycle_invisible_node=!0)},l.onScrollTouchUp=function(){this.recycleInvisibleNodes()},l.onScrollEnded=function(){this.recycleInvisibleNodes(),this.layout.onScrollEnded(this)},i(e,[{key:"scrollView",get:function(){var t=this.node.getComponent(gt);if(null==t&&(t=this.node.addComponent(gt)),null==t.content){var e=new p("com.yx.scroll.content");e.parent=t.node,e.layer=e.parent.layer,(e.getComponent(d)||e.addComponent(d)).contentSize=this.node.getComponent(d).contentSize,t.content=e}if(this.mask){var i=t.node.getComponent(m);null==i&&((i=t.node.addComponent(m)).type=m.Type.GRAPHICS_RECT)}return t}},{key:"_scrollView",get:function(){return this.scrollView}}]),e}(b)).ScrollDirection=pt,nt.Mode=dt,G=e((X=nt).prototype,"mask",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Z=e(X.prototype,"scrollEnabled",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),W=e(X.prototype,"wheelScrollEnabled",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j=e(X.prototype,"scrollDirection",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ct.ScrollDirection.VERTICAL}}),J=e(X.prototype,"mode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ct.Mode.RECYCLE}}),Q=e(X.prototype,"preloadNodesLimitPerFrame",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),$=e(X.prototype,"frameInterval",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tt=e(X.prototype,"recycleInterval",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),et=e(X.prototype,"registerCellForEditor",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),it=e(X.prototype,"registerSupplementaryForEditor",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H=X))||H)||H)||H)||H));t("YXBinaryLayout",function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).extraVisibleCount=0,e}return n(e,t),e.prototype.layoutAttributesForElementsInRect=function(e,i){if(this.attributes.length<=100)return this.attributes;if(this.extraVisibleCount<0)return this.attributes;for(var n=-1,o=0,r=this.attributes.length-1;o<=r&&r>=0;){var l=o+(r-o)/2;l=Math.floor(l);var s=this.attributes[l];if(e.intersects(s.frame)){n=l;break}e.yMax<s.frame.yMin||e.xMax<s.frame.xMin?r=l-1:o=l+1}if(n<0)return t.prototype.layoutAttributesForElementsInRect.call(this,e,i);var a=[];a.push(this.attributes[n]);for(var u=n;u>0;){var h=u-1,c=this.attributes[h];if(0==e.intersects(c.frame))break;a.push(c),u=h}for(var p=this.extraVisibleCount;p>0;){var d=u-1;if(d<0)break;var f=this.attributes[d];e.intersects(f.frame)&&a.push(f),u=d,p--}for(var y=n;y<this.attributes.length-1;){var m=y+1,b=this.attributes[m];if(0==e.intersects(b.frame))break;a.push(b),y=m}for(var g=this.extraVisibleCount;g>0;){var v=y+1;if(v>=this.attributes.length)break;var _=this.attributes[v];e.intersects(_.frame)&&a.push(_),y=v,g--}return a},e}(_t));l._RF.pop()}}}));

System.register("chunks:///_virtual/yx-table-layout.ts",["./rollupPluginModLoBabelHelpers.js","cc","./yx-collection-view.ts"],(function(e){var t,i,r,s,n,a,o,l,u;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,r=e.warn,s=e.UITransform,n=e.math},function(e){a=e.YXCollectionView,o=e.YXLayoutAttributes,l=e.YXIndexPath,u=e.YXLayout}],execute:function(){i._RF.push({},"0187dSr+7ZEqow2tXCfPb/0","yx-table-layout",void 0);var h=function(e){return e.HEADER="header",e.FOOTER="footer",e}(h||{});e("YXTableLayout",function(e){function i(){for(var t,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))||this).rowHeight=100,t.top=0,t.bottom=0,t.spacing=0,t.sectionHeaderHeight=null,t.sectionFooterHeight=null,t.sectionHeadersPinToVisibleBounds=!1,t.sectionFootersPinToVisibleBounds=!1,t.originalHeaderRect=new Map,t.originalFooterRect=new Map,t.allCellAttributes=[],t.allHeaderAttributes=[],t.allFooterAttributes=[],t}t(i,e);var u=i.prototype;return u.prepare=function(e){e.scrollView.horizontal=!1,e.scrollView.vertical=!0,e.scrollDirection===a.ScrollDirection.HORIZONTAL&&r("YXTableLayout 仅支持垂直方向排列"),this.attributes=[],this.allCellAttributes=[],this.allHeaderAttributes=[],this.allFooterAttributes=[],this.originalHeaderRect.clear(),this.originalFooterRect.clear();for(var t=e.node.getComponent(s).width,u=0,h=e.getNumberOfSections(),c=0;c<h;c++){var f=new l(c,0),p=0;if(this.sectionHeaderHeight&&(p=this.sectionHeaderHeight instanceof Function?this.sectionHeaderHeight(c):this.sectionHeaderHeight),p>0){var m=o.layoutAttributesForSupplementary(f,i.SupplementaryKinds.HEADER);m.frame.x=0,m.frame.width=t,m.frame.height=p,m.frame.y=u,m.zIndex=1,this.attributes.push(m),this.originalHeaderRect.set(c,m.frame.clone()),this.allHeaderAttributes.push(m),u=m.frame.yMax}u+=this.top;for(var g=e.getNumberOfItems(c),d=0;d<g;d++){var y=new l(c,d),b=o.layoutAttributesForCell(y),F=this.rowHeight instanceof Function?this.rowHeight(y):this.rowHeight;b.frame.x=0,b.frame.width=t,b.frame.height=F,b.frame.y=u+(d>0?this.spacing:0),this.attributes.push(b),this.allCellAttributes.push(b),u=b.frame.yMax}u+=this.bottom;var H=0;if(this.sectionFooterHeight&&(H=this.sectionFooterHeight instanceof Function?this.sectionFooterHeight(c):this.sectionFooterHeight),H>0){var v=o.layoutAttributesForSupplementary(f,i.SupplementaryKinds.FOOTER);v.frame.x=0,v.frame.width=t,v.frame.height=H,v.frame.y=u,v.zIndex=1,this.attributes.push(v),this.originalFooterRect.set(c,v.frame.clone()),this.allFooterAttributes.push(v),u=v.frame.yMax}}this.contentSize=new n.Size(t,u)},u.initOffset=function(e){e.scrollView.scrollToTop()},u.layoutAttributesForElementsInRect=function(e,t){var r=this.visibleElementsInRect(e,t);if(0==this.sectionHeadersPinToVisibleBounds&&0==this.sectionFootersPinToVisibleBounds)return r;for(var s=t.getNumberOfSections(),n=t.scrollView.getScrollOffset(),a=0;a<r.length;a++){var o=r[a];if("Supplementary"===o.elementCategory){if(this.sectionHeadersPinToVisibleBounds&&o.supplementaryKinds===i.SupplementaryKinds.HEADER){var l=this.originalHeaderRect.get(o.indexPath.section);o.frame.y=l.y,n.y>l.y&&(o.frame.y=n.y);var u=this.getNextOriginalFrame(o.indexPath.section,i.SupplementaryKinds.FOOTER,s);u&&o.frame.yMax>u.y&&(o.frame.y=u.y-o.frame.height)}if(this.sectionFootersPinToVisibleBounds&&o.supplementaryKinds===i.SupplementaryKinds.FOOTER){var h=n.y+t.scrollView.view.height,c=this.originalFooterRect.get(o.indexPath.section),f=this.getPreviousOriginalFrame(o.indexPath.section,i.SupplementaryKinds.HEADER);o.frame.y=c.y,h<c.yMax&&(o.frame.y=h-o.frame.height,f&&o.frame.y<f.yMax&&(o.frame.y=f.yMax))}}}return r},u.shouldUpdateAttributesZIndex=function(){return this.sectionHeadersPinToVisibleBounds||this.sectionFootersPinToVisibleBounds},u.shouldUpdateAttributesForBoundsChange=function(){return this.sectionHeadersPinToVisibleBounds||this.sectionFootersPinToVisibleBounds},u.getNextOriginalFrame=function(e,t,r){if(e>=r)return null;if(t===i.SupplementaryKinds.HEADER){var s=this.originalHeaderRect.get(e);return s||this.getNextOriginalFrame(e,i.SupplementaryKinds.FOOTER,r)}if(t===i.SupplementaryKinds.FOOTER){var n=this.originalFooterRect.get(e);return n||this.getNextOriginalFrame(e+1,i.SupplementaryKinds.HEADER,r)}return null},u.getPreviousOriginalFrame=function(e,t){if(e<0)return null;if(t===i.SupplementaryKinds.HEADER){var r=this.originalHeaderRect.get(e);return r||this.getPreviousOriginalFrame(e-1,i.SupplementaryKinds.FOOTER)}if(t===i.SupplementaryKinds.FOOTER){var s=this.originalFooterRect.get(e);return s||this.getPreviousOriginalFrame(e,i.SupplementaryKinds.HEADER)}return null},u.visibleElementsInRect=function(e,t){if(this.attributes.length<=100)return this.attributes;var i=[];i.push.apply(i,this.allHeaderAttributes),i.push.apply(i,this.allFooterAttributes);for(var r=-1,s=0,n=this.allCellAttributes.length-1;s<=n&&n>=0;){var a=s+(n-s)/2;a=Math.floor(a);var o=this.allCellAttributes[a];if(e.intersects(o.frame)){r=a;break}e.yMax<o.frame.yMin||e.xMax<o.frame.xMin?n=a-1:s=a+1}if(r<0)return this.attributes;i.push(this.allCellAttributes[r]);for(var l=r;l>0;){var u=l-1,h=this.allCellAttributes[u];if(0==e.intersects(h.frame))break;i.push(h),l=u}for(var c=r;c<this.allCellAttributes.length-1;){var f=c+1,p=this.allCellAttributes[f];if(0==e.intersects(p.frame))break;i.push(p),c=f}return i},i}(u)).SupplementaryKinds=h,i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});